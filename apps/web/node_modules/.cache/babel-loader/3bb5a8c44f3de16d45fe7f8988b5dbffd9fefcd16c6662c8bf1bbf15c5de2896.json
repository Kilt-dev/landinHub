{"ast":null,"code":"/**\r\n * IMPROVED RESPONSIVE SYNC UTILITIES\r\n * - Position & Size theo % thay vì pixel\r\n * - Separate layouts cho từng view mode\r\n * - Smart preview calculation\r\n */\n\n// ============================================================================\n// CONSTANTS & HELPERS\n// ============================================================================\n\nconst CANVAS_WIDTHS = {\n  desktop: 1200,\n  tablet: 768,\n  mobile: 375\n};\nconst CANVAS_HEIGHTS = {\n  desktop: 800,\n  // Có thể config\n  tablet: 1024,\n  mobile: 667\n};\n\n/**\r\n * Chuyển đổi pixel sang phần trăm\r\n */\nexport const pixelToPercent = (pixelValue, containerSize) => {\n  return pixelValue / containerSize * 100;\n};\n\n/**\r\n * Chuyển đổi phần trăm sang pixel\r\n */\nexport const percentToPixel = (percentValue, containerSize) => {\n  return percentValue / 100 * containerSize;\n};\n\n/**\r\n * Parse CSS value (hỗ trợ px, %, rem, em)\r\n */\nconst parseCSSValue = value => {\n  if (typeof value === 'number') {\n    return {\n      value,\n      unit: 'px'\n    };\n  }\n  if (typeof value === 'string') {\n    const match = value.match(/^([\\d.]+)(px|%|rem|em)?$/);\n    if (match) {\n      return {\n        value: parseFloat(match[1]),\n        unit: match[2] || 'px'\n      };\n    }\n  }\n  return null;\n};\n\n// ============================================================================\n// POSITION UTILITIES (% based)\n// ============================================================================\n\n/**\r\n * Normalize position sang % format\r\n * Input: { x: 100, y: 50, z: 1 } hoặc { x: '10%', y: '5%', z: 1 }\r\n * Output: { x: 8.33, y: 6.25, z: 1 } (% của canvas)\r\n */\nexport const normalizePosition = (position, viewMode, isPixel = true) => {\n  if (!position) {\n    return {\n      x: 0,\n      y: 0,\n      z: 1\n    };\n  }\n  const canvasWidth = CANVAS_WIDTHS[viewMode] || CANVAS_WIDTHS.desktop;\n  const canvasHeight = CANVAS_HEIGHTS[viewMode] || CANVAS_HEIGHTS.desktop;\n  let x = position.x || 0;\n  let y = position.y || 0;\n  if (isPixel) {\n    // Convert pixel to %\n    x = pixelToPercent(x, canvasWidth);\n    y = pixelToPercent(y, canvasHeight);\n  } else {\n    // Already % or string\n    const parsedX = parseCSSValue(x);\n    const parsedY = parseCSSValue(y);\n    x = (parsedX === null || parsedX === void 0 ? void 0 : parsedX.unit) === 'px' ? pixelToPercent(parsedX.value, canvasWidth) : (parsedX === null || parsedX === void 0 ? void 0 : parsedX.value) || 0;\n    y = (parsedY === null || parsedY === void 0 ? void 0 : parsedY.unit) === 'px' ? pixelToPercent(parsedY.value, canvasHeight) : (parsedY === null || parsedY === void 0 ? void 0 : parsedY.value) || 0;\n  }\n  return {\n    x: Math.max(0, Math.min(100, x)),\n    y: Math.max(0, Math.min(100, y)),\n    z: position.z || 1\n  };\n};\n\n/**\r\n * Denormalize position từ % sang pixel cho rendering\r\n */\nexport const denormalizePosition = (position, viewMode, containerWidth, containerHeight) => {\n  const canvasWidth = containerWidth || CANVAS_WIDTHS[viewMode] || CANVAS_WIDTHS.desktop;\n  const canvasHeight = containerHeight || CANVAS_HEIGHTS[viewMode] || CANVAS_HEIGHTS.desktop;\n  return {\n    x: percentToPixel(position.x || 0, canvasWidth),\n    y: percentToPixel(position.y || 0, canvasHeight),\n    z: position.z || 1\n  };\n};\n\n/**\r\n * Sync position giữa các view modes (với smart adjustment)\r\n */\nexport const syncPositionBetweenModes = (element, fromMode, toMode) => {\n  var _element$position;\n  // Lấy position % từ fromMode\n  const fromPosition = ((_element$position = element.position) === null || _element$position === void 0 ? void 0 : _element$position[fromMode]) || {\n    x: 0,\n    y: 0,\n    z: 1\n  };\n\n  // Đối với section/popup, có logic riêng\n  if (element.type === 'section') {\n    return {\n      x: 0,\n      y: fromPosition.y,\n      z: fromPosition.z || 1\n    };\n  }\n  if (element.type === 'popup' || element.type === 'modal') {\n    // Popup center (giữ z-index cao)\n    return {\n      x: fromPosition.x || 50,\n      // Center\n      y: fromPosition.y || 50,\n      z: fromPosition.z || 1001\n    };\n  }\n\n  // Các element khác: giữ nguyên % position\n  // (% position tự động responsive khi container thay đổi)\n  return {\n    x: fromPosition.x || 0,\n    y: fromPosition.y || 0,\n    z: fromPosition.z || 1\n  };\n};\n\n// ============================================================================\n// SIZE UTILITIES (% or smart pixel based)\n// ============================================================================\n\n/**\r\n * Normalize size sang % hoặc giữ pixel tùy element type\r\n */\nexport const normalizeSize = (size, elementType, viewMode) => {\n  if (!size) {\n    return getDefaultSize(elementType, viewMode);\n  }\n  const canvasWidth = CANVAS_WIDTHS[viewMode] || CANVAS_WIDTHS.desktop;\n\n  // Section luôn full width\n  if (elementType === 'section') {\n    return {\n      width: 100,\n      // 100% width\n      height: size.height || 400,\n      unit: 'percent'\n    };\n  }\n\n  // Popup/Modal có fixed width nhưng responsive\n  if (elementType === 'popup' || elementType === 'modal') {\n    const widths = {\n      mobile: 340,\n      tablet: 600,\n      desktop: 600\n    };\n    return {\n      width: pixelToPercent(widths[viewMode] || 600, canvasWidth),\n      height: size.height || 400,\n      unit: 'mixed' // width là %, height là px\n    };\n  }\n\n  // Các element khác: lưu width theo %\n  const parsedWidth = parseCSSValue(size.width);\n  const width = (parsedWidth === null || parsedWidth === void 0 ? void 0 : parsedWidth.unit) === 'px' ? pixelToPercent(parsedWidth.value, canvasWidth) : (parsedWidth === null || parsedWidth === void 0 ? void 0 : parsedWidth.value) || 20;\n  return {\n    width: Math.max(0, Math.min(100, width)),\n    height: size.height || 50,\n    unit: 'mixed'\n  };\n};\n\n/**\r\n * Denormalize size từ % sang pixel\r\n */\nexport const denormalizeSize = (size, viewMode, containerWidth) => {\n  const canvasWidth = containerWidth || CANVAS_WIDTHS[viewMode] || CANVAS_WIDTHS.desktop;\n  if (!size) return {\n    width: 200,\n    height: 50\n  };\n  const width = size.unit === 'percent' || size.unit === 'mixed' ? percentToPixel(size.width, canvasWidth) : size.width;\n  return {\n    width: Math.round(width),\n    height: size.height || 50\n  };\n};\n\n/**\r\n * Get default size cho element type\r\n */\nconst getDefaultSize = (elementType, viewMode) => {\n  const canvasWidth = CANVAS_WIDTHS[viewMode] || CANVAS_WIDTHS.desktop;\n  const defaults = {\n    section: {\n      width: 100,\n      height: 400,\n      unit: 'percent'\n    },\n    popup: {\n      width: pixelToPercent(600, canvasWidth),\n      height: 400,\n      unit: 'mixed'\n    },\n    modal: {\n      width: pixelToPercent(600, canvasWidth),\n      height: 400,\n      unit: 'mixed'\n    },\n    button: {\n      width: pixelToPercent(120, canvasWidth),\n      height: 40,\n      unit: 'mixed'\n    },\n    icon: {\n      width: pixelToPercent(32, canvasWidth),\n      height: 32,\n      unit: 'mixed'\n    },\n    image: {\n      width: pixelToPercent(200, canvasWidth),\n      height: 200,\n      unit: 'mixed'\n    },\n    heading: {\n      width: pixelToPercent(300, canvasWidth),\n      height: 48,\n      unit: 'mixed'\n    },\n    paragraph: {\n      width: pixelToPercent(400, canvasWidth),\n      height: 100,\n      unit: 'mixed'\n    },\n    gallery: {\n      width: pixelToPercent(600, canvasWidth),\n      height: 400,\n      unit: 'mixed'\n    },\n    default: {\n      width: pixelToPercent(200, canvasWidth),\n      height: 50,\n      unit: 'mixed'\n    }\n  };\n  return defaults[elementType] || defaults.default;\n};\n\n/**\r\n * Smart scale size với constraints\r\n */\nexport const smartScaleSize = (element, fromMode, toMode) => {\n  var _element$normalizedSi;\n  const fromSize = ((_element$normalizedSi = element.normalizedSize) === null || _element$normalizedSi === void 0 ? void 0 : _element$normalizedSi[fromMode]) || normalizeSize(element.size, element.type, fromMode);\n\n  // Section luôn full width\n  if (element.type === 'section') {\n    return {\n      width: 100,\n      height: fromSize.height,\n      unit: 'percent'\n    };\n  }\n\n  // Popup/Modal\n  if (element.type === 'popup' || element.type === 'modal') {\n    const canvasWidth = CANVAS_WIDTHS[toMode];\n    const widths = {\n      mobile: 340,\n      tablet: 600,\n      desktop: 600\n    };\n    return {\n      width: pixelToPercent(widths[toMode] || 600, canvasWidth),\n      height: fromSize.height,\n      unit: 'mixed'\n    };\n  }\n\n  // Các element khác: scale với constraints\n  const scaleFactor = CANVAS_WIDTHS[toMode] / CANVAS_WIDTHS[fromMode];\n  let scaledWidth = fromSize.width; // Already in %\n\n  // Apply min constraints\n  const canvasWidth = CANVAS_WIDTHS[toMode];\n  const minWidths = {\n    button: 80,\n    icon: 24,\n    image: 100,\n    heading: 150,\n    paragraph: 200,\n    gallery: 300,\n    default: 100\n  };\n  const minWidth = minWidths[element.type] || minWidths.default;\n  const minWidthPercent = pixelToPercent(minWidth, canvasWidth);\n\n  // Apply max constraints for mobile\n  let maxWidthPercent = 100;\n  if (toMode === 'mobile') {\n    maxWidthPercent = pixelToPercent(340, canvasWidth); // Leave padding\n  }\n  return {\n    width: Math.max(minWidthPercent, Math.min(scaledWidth, maxWidthPercent)),\n    height: Math.round(fromSize.height * scaleFactor),\n    unit: 'mixed'\n  };\n};\n\n// ============================================================================\n// STYLES SCALING\n// ============================================================================\n\n/**\r\n * Scale styles theo view mode\r\n */\nexport const scaleStyles = (styles, fromMode, toMode) => {\n  if (!styles) return {};\n  const scaleFactor = CANVAS_WIDTHS[toMode] / CANVAS_WIDTHS[fromMode];\n  const scaledStyles = {\n    ...styles\n  };\n  const scalableProps = ['fontSize', 'padding', 'paddingTop', 'paddingBottom', 'paddingLeft', 'paddingRight', 'margin', 'marginTop', 'marginBottom', 'marginLeft', 'marginRight', 'borderRadius', 'gap', 'borderWidth', 'strokeWidth', 'lineHeight'];\n  scalableProps.forEach(prop => {\n    if (scaledStyles[prop]) {\n      const parsed = parseCSSValue(scaledStyles[prop]);\n      if (parsed && parsed.unit === 'px') {\n        const scaled = Math.round(parsed.value * scaleFactor * 10) / 10;\n        const min = prop.includes('font') ? 10 : 4;\n        scaledStyles[prop] = `${Math.max(scaled, min)}px`;\n      }\n    }\n  });\n\n  // Compound values\n  if (scaledStyles.padding && typeof scaledStyles.padding === 'string' && scaledStyles.padding.includes(' ')) {\n    const values = scaledStyles.padding.split(' ');\n    const scaledValues = values.map(val => {\n      const parsed = parseCSSValue(val);\n      if (parsed && parsed.unit === 'px') {\n        const scaled = Math.round(parsed.value * scaleFactor * 10) / 10;\n        return `${Math.max(scaled, 4)}px`;\n      }\n      return val;\n    });\n    scaledStyles.padding = scaledValues.join(' ');\n  }\n  return scaledStyles;\n};\n\n// ============================================================================\n// COMPONENT DATA SCALING\n// ============================================================================\n\n/**\r\n * Scale componentData cho view mode\r\n */\nexport const scaleComponentData = (componentData, toMode) => {\n  if (!componentData) return {};\n  const scaled = {\n    ...componentData\n  };\n\n  // Columns adjustment\n  if (scaled.columns) {\n    if (toMode === 'mobile' && scaled.columns > 2) {\n      scaled.columns = 1;\n    } else if (toMode === 'tablet' && scaled.columns > 3) {\n      scaled.columns = 2;\n    }\n  }\n\n  // Gallery grid\n  if (scaled.images && scaled.images.length > 0) {\n    if (toMode === 'mobile') {\n      scaled.gridTemplateColumns = 'repeat(2, 1fr)';\n    } else if (toMode === 'tablet') {\n      scaled.gridTemplateColumns = 'repeat(3, 1fr)';\n    } else {\n      scaled.gridTemplateColumns = scaled.gridTemplateColumns || 'repeat(4, 1fr)';\n    }\n  }\n\n  // Gap scaling\n  if (scaled.gap) {\n    const parsed = parseCSSValue(scaled.gap);\n    if (parsed && parsed.unit === 'px') {\n      const factor = toMode === 'mobile' ? 0.5 : toMode === 'tablet' ? 0.75 : 1;\n      scaled.gap = `${Math.max(parsed.value * factor, 8)}px`;\n    }\n  }\n  return scaled;\n};\n\n// ============================================================================\n// MAIN SYNC FUNCTION\n// ============================================================================\n\n/**\r\n * Sync element between view modes với % based system\r\n */\nexport const syncElementBetweenModes = (element, changedMode) => {\n  const modes = ['desktop', 'tablet', 'mobile'];\n  const updatedElement = {\n    ...element\n  };\n\n  // Initialize position object\n  if (!updatedElement.position) {\n    updatedElement.position = {};\n  }\n\n  // Initialize normalizedSize object\n  if (!updatedElement.normalizedSize) {\n    updatedElement.normalizedSize = {};\n  }\n\n  // Normalize position & size cho changedMode (nếu chưa có)\n  if (!updatedElement.position[changedMode]) {\n    updatedElement.position[changedMode] = normalizePosition(updatedElement.position.desktop || {\n      x: 0,\n      y: 0,\n      z: 1\n    }, changedMode, true // is pixel\n    );\n  }\n  if (!updatedElement.normalizedSize[changedMode]) {\n    updatedElement.normalizedSize[changedMode] = normalizeSize(updatedElement.size, updatedElement.type, changedMode);\n  }\n\n  // Sync to other modes\n  modes.forEach(targetMode => {\n    if (targetMode !== changedMode) {\n      // Sync position (% based, auto-responsive)\n      updatedElement.position[targetMode] = syncPositionBetweenModes(updatedElement, changedMode, targetMode);\n\n      // Sync size với smart scaling\n      updatedElement.normalizedSize[targetMode] = smartScaleSize(updatedElement, changedMode, targetMode);\n    }\n  });\n\n  // Scale styles\n  if (!updatedElement.responsiveStyles) {\n    updatedElement.responsiveStyles = {};\n  }\n  updatedElement.responsiveStyles.tablet = scaleStyles(updatedElement.styles, 'desktop', 'tablet');\n  updatedElement.responsiveStyles.mobile = scaleStyles(updatedElement.styles, 'desktop', 'mobile');\n\n  // Scale componentData\n  updatedElement.tabletComponentData = scaleComponentData(updatedElement.componentData, 'tablet');\n  updatedElement.mobileComponentData = scaleComponentData(updatedElement.componentData, 'mobile');\n\n  // Sync children recursively\n  if (updatedElement.children && updatedElement.children.length > 0) {\n    updatedElement.children = updatedElement.children.map(child => syncElementBetweenModes(child, changedMode));\n  }\n  return updatedElement;\n};\n\n// ============================================================================\n// PREVIEW & RENDERING UTILITIES\n// ============================================================================\n\n/**\r\n * Get actual rendering values cho preview\r\n * Tính toán dựa trên container thực tế\r\n */\nexport const getPreviewValues = (element, viewMode, containerElement) => {\n  var _element$position2, _element$normalizedSi2, _element$responsiveSt;\n  let containerWidth = CANVAS_WIDTHS[viewMode];\n  let containerHeight = CANVAS_HEIGHTS[viewMode];\n\n  // Lấy kích thước thực tế từ DOM\n  if (containerElement) {\n    const rect = containerElement.getBoundingClientRect();\n    containerWidth = rect.width;\n    containerHeight = rect.height;\n  }\n\n  // Get normalized values\n  const normalizedPosition = ((_element$position2 = element.position) === null || _element$position2 === void 0 ? void 0 : _element$position2[viewMode]) || {\n    x: 0,\n    y: 0,\n    z: 1\n  };\n  const normalizedSize = ((_element$normalizedSi2 = element.normalizedSize) === null || _element$normalizedSi2 === void 0 ? void 0 : _element$normalizedSi2[viewMode]) || normalizeSize(element.size, element.type, viewMode);\n\n  // Convert to pixel\n  const position = denormalizePosition(normalizedPosition, viewMode, containerWidth, containerHeight);\n  const size = denormalizeSize(normalizedSize, viewMode, containerWidth);\n\n  // Get styles\n  const baseStyles = element.styles || {};\n  const responsiveStyles = ((_element$responsiveSt = element.responsiveStyles) === null || _element$responsiveSt === void 0 ? void 0 : _element$responsiveSt[viewMode]) || {};\n  const styles = {\n    ...baseStyles,\n    ...responsiveStyles\n  };\n\n  // Get componentData\n  const baseComponentData = element.componentData || {};\n  const responsiveComponentData = viewMode === 'mobile' ? element.mobileComponentData : viewMode === 'tablet' ? element.tabletComponentData : {};\n  const componentData = {\n    ...baseComponentData,\n    ...responsiveComponentData\n  };\n  return {\n    id: element.id,\n    type: element.type,\n    position,\n    size,\n    styles,\n    componentData,\n    children: element.children || [],\n    visible: element.visible !== false\n  };\n};\n\n/**\r\n * Batch sync all elements trong pageData\r\n */\nexport const syncAllElements = (pageData, currentMode) => {\n  return {\n    ...pageData,\n    elements: pageData.elements.map(element => syncElementBetweenModes(element, currentMode))\n  };\n};\n\n/**\r\n * Initialize responsive data cho elements mới\r\n */\nexport const initializeResponsiveData = (element, baseMode = 'desktop') => {\n  return syncElementBetweenModes(element, baseMode);\n};\n\n/**\r\n * Batch initialize cho pageData\r\n */\nexport const initializePageResponsiveData = pageData => {\n  return {\n    ...pageData,\n    elements: pageData.elements.map(element => {\n      var _element$position3;\n      // Chỉ init nếu chưa có responsive data\n      if (!((_element$position3 = element.position) !== null && _element$position3 !== void 0 && _element$position3.mobile) || !element.normalizedSize) {\n        return initializeResponsiveData(element, 'desktop');\n      }\n      return element;\n    })\n  };\n};\n\n// ============================================================================\n// MIGRATION UTILITIES (for existing data)\n// ============================================================================\n\n/**\r\n * Migrate element từ pixel-based sang % based\r\n */\nexport const migrateElementToPercentBased = element => {\n  const modes = ['desktop', 'tablet', 'mobile'];\n  const migrated = {\n    ...element\n  };\n\n  // Migrate positions\n  if (!migrated.position) {\n    migrated.position = {};\n  }\n  modes.forEach(mode => {\n    if (migrated.position[mode]) {\n      migrated.position[mode] = normalizePosition(migrated.position[mode], mode, true // is pixel\n      );\n    }\n  });\n\n  // Migrate sizes\n  if (!migrated.normalizedSize) {\n    migrated.normalizedSize = {};\n  }\n  modes.forEach(mode => {\n    const sizeKey = mode === 'mobile' ? 'mobileSize' : mode === 'tablet' ? 'tabletSize' : 'size';\n    if (migrated[sizeKey]) {\n      migrated.normalizedSize[mode] = normalizeSize(migrated[sizeKey], migrated.type, mode);\n    }\n  });\n\n  // Migrate children\n  if (migrated.children && migrated.children.length > 0) {\n    migrated.children = migrated.children.map(migrateElementToPercentBased);\n  }\n  return migrated;\n};\n\n/**\r\n * Migrate toàn bộ pageData\r\n */\nexport const migratePageDataToPercentBased = pageData => {\n  return {\n    ...pageData,\n    elements: pageData.elements.map(migrateElementToPercentBased)\n  };\n};\n\n// ============================================================================\n// EXPORTS\n// ============================================================================\n\nexport default {\n  // Position utilities\n  normalizePosition,\n  denormalizePosition,\n  syncPositionBetweenModes,\n  // Size utilities\n  normalizeSize,\n  denormalizeSize,\n  smartScaleSize,\n  // Scaling\n  scaleStyles,\n  scaleComponentData,\n  // Main sync\n  syncElementBetweenModes,\n  syncAllElements,\n  // Preview & rendering\n  getPreviewValues,\n  // Initialization\n  initializeResponsiveData,\n  initializePageResponsiveData,\n  // Migration\n  migrateElementToPercentBased,\n  migratePageDataToPercentBased,\n  // Helpers\n  pixelToPercent,\n  percentToPixel,\n  // Constants\n  CANVAS_WIDTHS,\n  CANVAS_HEIGHTS\n};","map":{"version":3,"names":["CANVAS_WIDTHS","desktop","tablet","mobile","CANVAS_HEIGHTS","pixelToPercent","pixelValue","containerSize","percentToPixel","percentValue","parseCSSValue","value","unit","match","parseFloat","normalizePosition","position","viewMode","isPixel","x","y","z","canvasWidth","canvasHeight","parsedX","parsedY","Math","max","min","denormalizePosition","containerWidth","containerHeight","syncPositionBetweenModes","element","fromMode","toMode","_element$position","fromPosition","type","normalizeSize","size","elementType","getDefaultSize","width","height","widths","parsedWidth","denormalizeSize","round","defaults","section","popup","modal","button","icon","image","heading","paragraph","gallery","default","smartScaleSize","_element$normalizedSi","fromSize","normalizedSize","scaleFactor","scaledWidth","minWidths","minWidth","minWidthPercent","maxWidthPercent","scaleStyles","styles","scaledStyles","scalableProps","forEach","prop","parsed","scaled","includes","padding","values","split","scaledValues","map","val","join","scaleComponentData","componentData","columns","images","length","gridTemplateColumns","gap","factor","syncElementBetweenModes","changedMode","modes","updatedElement","targetMode","responsiveStyles","tabletComponentData","mobileComponentData","children","child","getPreviewValues","containerElement","_element$position2","_element$normalizedSi2","_element$responsiveSt","rect","getBoundingClientRect","normalizedPosition","baseStyles","baseComponentData","responsiveComponentData","id","visible","syncAllElements","pageData","currentMode","elements","initializeResponsiveData","baseMode","initializePageResponsiveData","_element$position3","migrateElementToPercentBased","migrated","mode","sizeKey","migratePageDataToPercentBased"],"sources":["F:/landinghub-iconic/apps/web/src/utils/responsiveSync.js"],"sourcesContent":["/**\r\n * IMPROVED RESPONSIVE SYNC UTILITIES\r\n * - Position & Size theo % thay vì pixel\r\n * - Separate layouts cho từng view mode\r\n * - Smart preview calculation\r\n */\r\n\r\n// ============================================================================\r\n// CONSTANTS & HELPERS\r\n// ============================================================================\r\n\r\nconst CANVAS_WIDTHS = {\r\n    desktop: 1200,\r\n    tablet: 768,\r\n    mobile: 375\r\n};\r\n\r\nconst CANVAS_HEIGHTS = {\r\n    desktop: 800, // Có thể config\r\n    tablet: 1024,\r\n    mobile: 667\r\n};\r\n\r\n/**\r\n * Chuyển đổi pixel sang phần trăm\r\n */\r\nexport const pixelToPercent = (pixelValue, containerSize) => {\r\n    return (pixelValue / containerSize) * 100;\r\n};\r\n\r\n/**\r\n * Chuyển đổi phần trăm sang pixel\r\n */\r\nexport const percentToPixel = (percentValue, containerSize) => {\r\n    return (percentValue / 100) * containerSize;\r\n};\r\n\r\n/**\r\n * Parse CSS value (hỗ trợ px, %, rem, em)\r\n */\r\nconst parseCSSValue = (value) => {\r\n    if (typeof value === 'number') {\r\n        return { value, unit: 'px' };\r\n    }\r\n    if (typeof value === 'string') {\r\n        const match = value.match(/^([\\d.]+)(px|%|rem|em)?$/);\r\n        if (match) {\r\n            return {\r\n                value: parseFloat(match[1]),\r\n                unit: match[2] || 'px'\r\n            };\r\n        }\r\n    }\r\n    return null;\r\n};\r\n\r\n// ============================================================================\r\n// POSITION UTILITIES (% based)\r\n// ============================================================================\r\n\r\n/**\r\n * Normalize position sang % format\r\n * Input: { x: 100, y: 50, z: 1 } hoặc { x: '10%', y: '5%', z: 1 }\r\n * Output: { x: 8.33, y: 6.25, z: 1 } (% của canvas)\r\n */\r\nexport const normalizePosition = (position, viewMode, isPixel = true) => {\r\n    if (!position) {\r\n        return { x: 0, y: 0, z: 1 };\r\n    }\r\n\r\n    const canvasWidth = CANVAS_WIDTHS[viewMode] || CANVAS_WIDTHS.desktop;\r\n    const canvasHeight = CANVAS_HEIGHTS[viewMode] || CANVAS_HEIGHTS.desktop;\r\n\r\n    let x = position.x || 0;\r\n    let y = position.y || 0;\r\n\r\n    if (isPixel) {\r\n        // Convert pixel to %\r\n        x = pixelToPercent(x, canvasWidth);\r\n        y = pixelToPercent(y, canvasHeight);\r\n    } else {\r\n        // Already % or string\r\n        const parsedX = parseCSSValue(x);\r\n        const parsedY = parseCSSValue(y);\r\n\r\n        x = parsedX?.unit === 'px'\r\n            ? pixelToPercent(parsedX.value, canvasWidth)\r\n            : (parsedX?.value || 0);\r\n\r\n        y = parsedY?.unit === 'px'\r\n            ? pixelToPercent(parsedY.value, canvasHeight)\r\n            : (parsedY?.value || 0);\r\n    }\r\n\r\n    return {\r\n        x: Math.max(0, Math.min(100, x)),\r\n        y: Math.max(0, Math.min(100, y)),\r\n        z: position.z || 1\r\n    };\r\n};\r\n\r\n/**\r\n * Denormalize position từ % sang pixel cho rendering\r\n */\r\nexport const denormalizePosition = (position, viewMode, containerWidth, containerHeight) => {\r\n    const canvasWidth = containerWidth || CANVAS_WIDTHS[viewMode] || CANVAS_WIDTHS.desktop;\r\n    const canvasHeight = containerHeight || CANVAS_HEIGHTS[viewMode] || CANVAS_HEIGHTS.desktop;\r\n\r\n    return {\r\n        x: percentToPixel(position.x || 0, canvasWidth),\r\n        y: percentToPixel(position.y || 0, canvasHeight),\r\n        z: position.z || 1\r\n    };\r\n};\r\n\r\n/**\r\n * Sync position giữa các view modes (với smart adjustment)\r\n */\r\nexport const syncPositionBetweenModes = (element, fromMode, toMode) => {\r\n    // Lấy position % từ fromMode\r\n    const fromPosition = element.position?.[fromMode] || { x: 0, y: 0, z: 1 };\r\n\r\n    // Đối với section/popup, có logic riêng\r\n    if (element.type === 'section') {\r\n        return { x: 0, y: fromPosition.y, z: fromPosition.z || 1 };\r\n    }\r\n\r\n    if (element.type === 'popup' || element.type === 'modal') {\r\n        // Popup center (giữ z-index cao)\r\n        return {\r\n            x: fromPosition.x || 50, // Center\r\n            y: fromPosition.y || 50,\r\n            z: fromPosition.z || 1001\r\n        };\r\n    }\r\n\r\n    // Các element khác: giữ nguyên % position\r\n    // (% position tự động responsive khi container thay đổi)\r\n    return {\r\n        x: fromPosition.x || 0,\r\n        y: fromPosition.y || 0,\r\n        z: fromPosition.z || 1\r\n    };\r\n};\r\n\r\n// ============================================================================\r\n// SIZE UTILITIES (% or smart pixel based)\r\n// ============================================================================\r\n\r\n/**\r\n * Normalize size sang % hoặc giữ pixel tùy element type\r\n */\r\nexport const normalizeSize = (size, elementType, viewMode) => {\r\n    if (!size) {\r\n        return getDefaultSize(elementType, viewMode);\r\n    }\r\n\r\n    const canvasWidth = CANVAS_WIDTHS[viewMode] || CANVAS_WIDTHS.desktop;\r\n\r\n    // Section luôn full width\r\n    if (elementType === 'section') {\r\n        return {\r\n            width: 100, // 100% width\r\n            height: size.height || 400,\r\n            unit: 'percent'\r\n        };\r\n    }\r\n\r\n    // Popup/Modal có fixed width nhưng responsive\r\n    if (elementType === 'popup' || elementType === 'modal') {\r\n        const widths = { mobile: 340, tablet: 600, desktop: 600 };\r\n        return {\r\n            width: pixelToPercent(widths[viewMode] || 600, canvasWidth),\r\n            height: size.height || 400,\r\n            unit: 'mixed' // width là %, height là px\r\n        };\r\n    }\r\n\r\n    // Các element khác: lưu width theo %\r\n    const parsedWidth = parseCSSValue(size.width);\r\n    const width = parsedWidth?.unit === 'px'\r\n        ? pixelToPercent(parsedWidth.value, canvasWidth)\r\n        : (parsedWidth?.value || 20);\r\n\r\n    return {\r\n        width: Math.max(0, Math.min(100, width)),\r\n        height: size.height || 50,\r\n        unit: 'mixed'\r\n    };\r\n};\r\n\r\n/**\r\n * Denormalize size từ % sang pixel\r\n */\r\nexport const denormalizeSize = (size, viewMode, containerWidth) => {\r\n    const canvasWidth = containerWidth || CANVAS_WIDTHS[viewMode] || CANVAS_WIDTHS.desktop;\r\n\r\n    if (!size) return { width: 200, height: 50 };\r\n\r\n    const width = size.unit === 'percent' || size.unit === 'mixed'\r\n        ? percentToPixel(size.width, canvasWidth)\r\n        : size.width;\r\n\r\n    return {\r\n        width: Math.round(width),\r\n        height: size.height || 50\r\n    };\r\n};\r\n\r\n/**\r\n * Get default size cho element type\r\n */\r\nconst getDefaultSize = (elementType, viewMode) => {\r\n    const canvasWidth = CANVAS_WIDTHS[viewMode] || CANVAS_WIDTHS.desktop;\r\n\r\n    const defaults = {\r\n        section: { width: 100, height: 400, unit: 'percent' },\r\n        popup: { width: pixelToPercent(600, canvasWidth), height: 400, unit: 'mixed' },\r\n        modal: { width: pixelToPercent(600, canvasWidth), height: 400, unit: 'mixed' },\r\n        button: { width: pixelToPercent(120, canvasWidth), height: 40, unit: 'mixed' },\r\n        icon: { width: pixelToPercent(32, canvasWidth), height: 32, unit: 'mixed' },\r\n        image: { width: pixelToPercent(200, canvasWidth), height: 200, unit: 'mixed' },\r\n        heading: { width: pixelToPercent(300, canvasWidth), height: 48, unit: 'mixed' },\r\n        paragraph: { width: pixelToPercent(400, canvasWidth), height: 100, unit: 'mixed' },\r\n        gallery: { width: pixelToPercent(600, canvasWidth), height: 400, unit: 'mixed' },\r\n        default: { width: pixelToPercent(200, canvasWidth), height: 50, unit: 'mixed' }\r\n    };\r\n\r\n    return defaults[elementType] || defaults.default;\r\n};\r\n\r\n/**\r\n * Smart scale size với constraints\r\n */\r\nexport const smartScaleSize = (element, fromMode, toMode) => {\r\n    const fromSize = element.normalizedSize?.[fromMode]\r\n        || normalizeSize(element.size, element.type, fromMode);\r\n\r\n    // Section luôn full width\r\n    if (element.type === 'section') {\r\n        return { width: 100, height: fromSize.height, unit: 'percent' };\r\n    }\r\n\r\n    // Popup/Modal\r\n    if (element.type === 'popup' || element.type === 'modal') {\r\n        const canvasWidth = CANVAS_WIDTHS[toMode];\r\n        const widths = { mobile: 340, tablet: 600, desktop: 600 };\r\n        return {\r\n            width: pixelToPercent(widths[toMode] || 600, canvasWidth),\r\n            height: fromSize.height,\r\n            unit: 'mixed'\r\n        };\r\n    }\r\n\r\n    // Các element khác: scale với constraints\r\n    const scaleFactor = CANVAS_WIDTHS[toMode] / CANVAS_WIDTHS[fromMode];\r\n    let scaledWidth = fromSize.width; // Already in %\r\n\r\n    // Apply min constraints\r\n    const canvasWidth = CANVAS_WIDTHS[toMode];\r\n    const minWidths = {\r\n        button: 80, icon: 24, image: 100, heading: 150,\r\n        paragraph: 200, gallery: 300, default: 100\r\n    };\r\n    const minWidth = minWidths[element.type] || minWidths.default;\r\n    const minWidthPercent = pixelToPercent(minWidth, canvasWidth);\r\n\r\n    // Apply max constraints for mobile\r\n    let maxWidthPercent = 100;\r\n    if (toMode === 'mobile') {\r\n        maxWidthPercent = pixelToPercent(340, canvasWidth); // Leave padding\r\n    }\r\n\r\n    return {\r\n        width: Math.max(minWidthPercent, Math.min(scaledWidth, maxWidthPercent)),\r\n        height: Math.round(fromSize.height * scaleFactor),\r\n        unit: 'mixed'\r\n    };\r\n};\r\n\r\n// ============================================================================\r\n// STYLES SCALING\r\n// ============================================================================\r\n\r\n/**\r\n * Scale styles theo view mode\r\n */\r\nexport const scaleStyles = (styles, fromMode, toMode) => {\r\n    if (!styles) return {};\r\n\r\n    const scaleFactor = CANVAS_WIDTHS[toMode] / CANVAS_WIDTHS[fromMode];\r\n    const scaledStyles = { ...styles };\r\n\r\n    const scalableProps = [\r\n        'fontSize', 'padding', 'paddingTop', 'paddingBottom',\r\n        'paddingLeft', 'paddingRight', 'margin', 'marginTop',\r\n        'marginBottom', 'marginLeft', 'marginRight', 'borderRadius',\r\n        'gap', 'borderWidth', 'strokeWidth', 'lineHeight'\r\n    ];\r\n\r\n    scalableProps.forEach(prop => {\r\n        if (scaledStyles[prop]) {\r\n            const parsed = parseCSSValue(scaledStyles[prop]);\r\n            if (parsed && parsed.unit === 'px') {\r\n                const scaled = Math.round(parsed.value * scaleFactor * 10) / 10;\r\n                const min = prop.includes('font') ? 10 : 4;\r\n                scaledStyles[prop] = `${Math.max(scaled, min)}px`;\r\n            }\r\n        }\r\n    });\r\n\r\n    // Compound values\r\n    if (scaledStyles.padding && typeof scaledStyles.padding === 'string' && scaledStyles.padding.includes(' ')) {\r\n        const values = scaledStyles.padding.split(' ');\r\n        const scaledValues = values.map(val => {\r\n            const parsed = parseCSSValue(val);\r\n            if (parsed && parsed.unit === 'px') {\r\n                const scaled = Math.round(parsed.value * scaleFactor * 10) / 10;\r\n                return `${Math.max(scaled, 4)}px`;\r\n            }\r\n            return val;\r\n        });\r\n        scaledStyles.padding = scaledValues.join(' ');\r\n    }\r\n\r\n    return scaledStyles;\r\n};\r\n\r\n// ============================================================================\r\n// COMPONENT DATA SCALING\r\n// ============================================================================\r\n\r\n/**\r\n * Scale componentData cho view mode\r\n */\r\nexport const scaleComponentData = (componentData, toMode) => {\r\n    if (!componentData) return {};\r\n\r\n    const scaled = { ...componentData };\r\n\r\n    // Columns adjustment\r\n    if (scaled.columns) {\r\n        if (toMode === 'mobile' && scaled.columns > 2) {\r\n            scaled.columns = 1;\r\n        } else if (toMode === 'tablet' && scaled.columns > 3) {\r\n            scaled.columns = 2;\r\n        }\r\n    }\r\n\r\n    // Gallery grid\r\n    if (scaled.images && scaled.images.length > 0) {\r\n        if (toMode === 'mobile') {\r\n            scaled.gridTemplateColumns = 'repeat(2, 1fr)';\r\n        } else if (toMode === 'tablet') {\r\n            scaled.gridTemplateColumns = 'repeat(3, 1fr)';\r\n        } else {\r\n            scaled.gridTemplateColumns = scaled.gridTemplateColumns || 'repeat(4, 1fr)';\r\n        }\r\n    }\r\n\r\n    // Gap scaling\r\n    if (scaled.gap) {\r\n        const parsed = parseCSSValue(scaled.gap);\r\n        if (parsed && parsed.unit === 'px') {\r\n            const factor = toMode === 'mobile' ? 0.5 : toMode === 'tablet' ? 0.75 : 1;\r\n            scaled.gap = `${Math.max(parsed.value * factor, 8)}px`;\r\n        }\r\n    }\r\n\r\n    return scaled;\r\n};\r\n\r\n// ============================================================================\r\n// MAIN SYNC FUNCTION\r\n// ============================================================================\r\n\r\n/**\r\n * Sync element between view modes với % based system\r\n */\r\nexport const syncElementBetweenModes = (element, changedMode) => {\r\n    const modes = ['desktop', 'tablet', 'mobile'];\r\n    const updatedElement = { ...element };\r\n\r\n    // Initialize position object\r\n    if (!updatedElement.position) {\r\n        updatedElement.position = {};\r\n    }\r\n\r\n    // Initialize normalizedSize object\r\n    if (!updatedElement.normalizedSize) {\r\n        updatedElement.normalizedSize = {};\r\n    }\r\n\r\n    // Normalize position & size cho changedMode (nếu chưa có)\r\n    if (!updatedElement.position[changedMode]) {\r\n        updatedElement.position[changedMode] = normalizePosition(\r\n            updatedElement.position.desktop || { x: 0, y: 0, z: 1 },\r\n            changedMode,\r\n            true // is pixel\r\n        );\r\n    }\r\n\r\n    if (!updatedElement.normalizedSize[changedMode]) {\r\n        updatedElement.normalizedSize[changedMode] = normalizeSize(\r\n            updatedElement.size,\r\n            updatedElement.type,\r\n            changedMode\r\n        );\r\n    }\r\n\r\n    // Sync to other modes\r\n    modes.forEach(targetMode => {\r\n        if (targetMode !== changedMode) {\r\n            // Sync position (% based, auto-responsive)\r\n            updatedElement.position[targetMode] = syncPositionBetweenModes(\r\n                updatedElement,\r\n                changedMode,\r\n                targetMode\r\n            );\r\n\r\n            // Sync size với smart scaling\r\n            updatedElement.normalizedSize[targetMode] = smartScaleSize(\r\n                updatedElement,\r\n                changedMode,\r\n                targetMode\r\n            );\r\n        }\r\n    });\r\n\r\n    // Scale styles\r\n    if (!updatedElement.responsiveStyles) {\r\n        updatedElement.responsiveStyles = {};\r\n    }\r\n\r\n    updatedElement.responsiveStyles.tablet = scaleStyles(\r\n        updatedElement.styles,\r\n        'desktop',\r\n        'tablet'\r\n    );\r\n\r\n    updatedElement.responsiveStyles.mobile = scaleStyles(\r\n        updatedElement.styles,\r\n        'desktop',\r\n        'mobile'\r\n    );\r\n\r\n    // Scale componentData\r\n    updatedElement.tabletComponentData = scaleComponentData(\r\n        updatedElement.componentData,\r\n        'tablet'\r\n    );\r\n\r\n    updatedElement.mobileComponentData = scaleComponentData(\r\n        updatedElement.componentData,\r\n        'mobile'\r\n    );\r\n\r\n    // Sync children recursively\r\n    if (updatedElement.children && updatedElement.children.length > 0) {\r\n        updatedElement.children = updatedElement.children.map(child =>\r\n            syncElementBetweenModes(child, changedMode)\r\n        );\r\n    }\r\n\r\n    return updatedElement;\r\n};\r\n\r\n// ============================================================================\r\n// PREVIEW & RENDERING UTILITIES\r\n// ============================================================================\r\n\r\n/**\r\n * Get actual rendering values cho preview\r\n * Tính toán dựa trên container thực tế\r\n */\r\nexport const getPreviewValues = (element, viewMode, containerElement) => {\r\n    let containerWidth = CANVAS_WIDTHS[viewMode];\r\n    let containerHeight = CANVAS_HEIGHTS[viewMode];\r\n\r\n    // Lấy kích thước thực tế từ DOM\r\n    if (containerElement) {\r\n        const rect = containerElement.getBoundingClientRect();\r\n        containerWidth = rect.width;\r\n        containerHeight = rect.height;\r\n    }\r\n\r\n    // Get normalized values\r\n    const normalizedPosition = element.position?.[viewMode] || { x: 0, y: 0, z: 1 };\r\n    const normalizedSize = element.normalizedSize?.[viewMode]\r\n        || normalizeSize(element.size, element.type, viewMode);\r\n\r\n    // Convert to pixel\r\n    const position = denormalizePosition(normalizedPosition, viewMode, containerWidth, containerHeight);\r\n    const size = denormalizeSize(normalizedSize, viewMode, containerWidth);\r\n\r\n    // Get styles\r\n    const baseStyles = element.styles || {};\r\n    const responsiveStyles = element.responsiveStyles?.[viewMode] || {};\r\n    const styles = { ...baseStyles, ...responsiveStyles };\r\n\r\n    // Get componentData\r\n    const baseComponentData = element.componentData || {};\r\n    const responsiveComponentData =\r\n        viewMode === 'mobile' ? element.mobileComponentData :\r\n            viewMode === 'tablet' ? element.tabletComponentData :\r\n                {};\r\n    const componentData = { ...baseComponentData, ...responsiveComponentData };\r\n\r\n    return {\r\n        id: element.id,\r\n        type: element.type,\r\n        position,\r\n        size,\r\n        styles,\r\n        componentData,\r\n        children: element.children || [],\r\n        visible: element.visible !== false,\r\n    };\r\n};\r\n\r\n/**\r\n * Batch sync all elements trong pageData\r\n */\r\nexport const syncAllElements = (pageData, currentMode) => {\r\n    return {\r\n        ...pageData,\r\n        elements: pageData.elements.map(element =>\r\n            syncElementBetweenModes(element, currentMode)\r\n        )\r\n    };\r\n};\r\n\r\n/**\r\n * Initialize responsive data cho elements mới\r\n */\r\nexport const initializeResponsiveData = (element, baseMode = 'desktop') => {\r\n    return syncElementBetweenModes(element, baseMode);\r\n};\r\n\r\n/**\r\n * Batch initialize cho pageData\r\n */\r\nexport const initializePageResponsiveData = (pageData) => {\r\n    return {\r\n        ...pageData,\r\n        elements: pageData.elements.map(element => {\r\n            // Chỉ init nếu chưa có responsive data\r\n            if (!element.position?.mobile || !element.normalizedSize) {\r\n                return initializeResponsiveData(element, 'desktop');\r\n            }\r\n            return element;\r\n        })\r\n    };\r\n};\r\n\r\n// ============================================================================\r\n// MIGRATION UTILITIES (for existing data)\r\n// ============================================================================\r\n\r\n/**\r\n * Migrate element từ pixel-based sang % based\r\n */\r\nexport const migrateElementToPercentBased = (element) => {\r\n    const modes = ['desktop', 'tablet', 'mobile'];\r\n    const migrated = { ...element };\r\n\r\n    // Migrate positions\r\n    if (!migrated.position) {\r\n        migrated.position = {};\r\n    }\r\n\r\n    modes.forEach(mode => {\r\n        if (migrated.position[mode]) {\r\n            migrated.position[mode] = normalizePosition(\r\n                migrated.position[mode],\r\n                mode,\r\n                true // is pixel\r\n            );\r\n        }\r\n    });\r\n\r\n    // Migrate sizes\r\n    if (!migrated.normalizedSize) {\r\n        migrated.normalizedSize = {};\r\n    }\r\n\r\n    modes.forEach(mode => {\r\n        const sizeKey = mode === 'mobile' ? 'mobileSize' :\r\n            mode === 'tablet' ? 'tabletSize' : 'size';\r\n\r\n        if (migrated[sizeKey]) {\r\n            migrated.normalizedSize[mode] = normalizeSize(\r\n                migrated[sizeKey],\r\n                migrated.type,\r\n                mode\r\n            );\r\n        }\r\n    });\r\n\r\n    // Migrate children\r\n    if (migrated.children && migrated.children.length > 0) {\r\n        migrated.children = migrated.children.map(migrateElementToPercentBased);\r\n    }\r\n\r\n    return migrated;\r\n};\r\n\r\n/**\r\n * Migrate toàn bộ pageData\r\n */\r\nexport const migratePageDataToPercentBased = (pageData) => {\r\n    return {\r\n        ...pageData,\r\n        elements: pageData.elements.map(migrateElementToPercentBased)\r\n    };\r\n};\r\n\r\n// ============================================================================\r\n// EXPORTS\r\n// ============================================================================\r\n\r\nexport default {\r\n    // Position utilities\r\n    normalizePosition,\r\n    denormalizePosition,\r\n    syncPositionBetweenModes,\r\n\r\n    // Size utilities\r\n    normalizeSize,\r\n    denormalizeSize,\r\n    smartScaleSize,\r\n\r\n    // Scaling\r\n    scaleStyles,\r\n    scaleComponentData,\r\n\r\n    // Main sync\r\n    syncElementBetweenModes,\r\n    syncAllElements,\r\n\r\n    // Preview & rendering\r\n    getPreviewValues,\r\n\r\n    // Initialization\r\n    initializeResponsiveData,\r\n    initializePageResponsiveData,\r\n\r\n    // Migration\r\n    migrateElementToPercentBased,\r\n    migratePageDataToPercentBased,\r\n\r\n    // Helpers\r\n    pixelToPercent,\r\n    percentToPixel,\r\n\r\n    // Constants\r\n    CANVAS_WIDTHS,\r\n    CANVAS_HEIGHTS\r\n};"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,MAAMA,aAAa,GAAG;EAClBC,OAAO,EAAE,IAAI;EACbC,MAAM,EAAE,GAAG;EACXC,MAAM,EAAE;AACZ,CAAC;AAED,MAAMC,cAAc,GAAG;EACnBH,OAAO,EAAE,GAAG;EAAE;EACdC,MAAM,EAAE,IAAI;EACZC,MAAM,EAAE;AACZ,CAAC;;AAED;AACA;AACA;AACA,OAAO,MAAME,cAAc,GAAGA,CAACC,UAAU,EAAEC,aAAa,KAAK;EACzD,OAAQD,UAAU,GAAGC,aAAa,GAAI,GAAG;AAC7C,CAAC;;AAED;AACA;AACA;AACA,OAAO,MAAMC,cAAc,GAAGA,CAACC,YAAY,EAAEF,aAAa,KAAK;EAC3D,OAAQE,YAAY,GAAG,GAAG,GAAIF,aAAa;AAC/C,CAAC;;AAED;AACA;AACA;AACA,MAAMG,aAAa,GAAIC,KAAK,IAAK;EAC7B,IAAI,OAAOA,KAAK,KAAK,QAAQ,EAAE;IAC3B,OAAO;MAAEA,KAAK;MAAEC,IAAI,EAAE;IAAK,CAAC;EAChC;EACA,IAAI,OAAOD,KAAK,KAAK,QAAQ,EAAE;IAC3B,MAAME,KAAK,GAAGF,KAAK,CAACE,KAAK,CAAC,0BAA0B,CAAC;IACrD,IAAIA,KAAK,EAAE;MACP,OAAO;QACHF,KAAK,EAAEG,UAAU,CAACD,KAAK,CAAC,CAAC,CAAC,CAAC;QAC3BD,IAAI,EAAEC,KAAK,CAAC,CAAC,CAAC,IAAI;MACtB,CAAC;IACL;EACJ;EACA,OAAO,IAAI;AACf,CAAC;;AAED;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO,MAAME,iBAAiB,GAAGA,CAACC,QAAQ,EAAEC,QAAQ,EAAEC,OAAO,GAAG,IAAI,KAAK;EACrE,IAAI,CAACF,QAAQ,EAAE;IACX,OAAO;MAAEG,CAAC,EAAE,CAAC;MAAEC,CAAC,EAAE,CAAC;MAAEC,CAAC,EAAE;IAAE,CAAC;EAC/B;EAEA,MAAMC,WAAW,GAAGtB,aAAa,CAACiB,QAAQ,CAAC,IAAIjB,aAAa,CAACC,OAAO;EACpE,MAAMsB,YAAY,GAAGnB,cAAc,CAACa,QAAQ,CAAC,IAAIb,cAAc,CAACH,OAAO;EAEvE,IAAIkB,CAAC,GAAGH,QAAQ,CAACG,CAAC,IAAI,CAAC;EACvB,IAAIC,CAAC,GAAGJ,QAAQ,CAACI,CAAC,IAAI,CAAC;EAEvB,IAAIF,OAAO,EAAE;IACT;IACAC,CAAC,GAAGd,cAAc,CAACc,CAAC,EAAEG,WAAW,CAAC;IAClCF,CAAC,GAAGf,cAAc,CAACe,CAAC,EAAEG,YAAY,CAAC;EACvC,CAAC,MAAM;IACH;IACA,MAAMC,OAAO,GAAGd,aAAa,CAACS,CAAC,CAAC;IAChC,MAAMM,OAAO,GAAGf,aAAa,CAACU,CAAC,CAAC;IAEhCD,CAAC,GAAG,CAAAK,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEZ,IAAI,MAAK,IAAI,GACpBP,cAAc,CAACmB,OAAO,CAACb,KAAK,EAAEW,WAAW,CAAC,GACzC,CAAAE,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEb,KAAK,KAAI,CAAE;IAE3BS,CAAC,GAAG,CAAAK,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEb,IAAI,MAAK,IAAI,GACpBP,cAAc,CAACoB,OAAO,CAACd,KAAK,EAAEY,YAAY,CAAC,GAC1C,CAAAE,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEd,KAAK,KAAI,CAAE;EAC/B;EAEA,OAAO;IACHQ,CAAC,EAAEO,IAAI,CAACC,GAAG,CAAC,CAAC,EAAED,IAAI,CAACE,GAAG,CAAC,GAAG,EAAET,CAAC,CAAC,CAAC;IAChCC,CAAC,EAAEM,IAAI,CAACC,GAAG,CAAC,CAAC,EAAED,IAAI,CAACE,GAAG,CAAC,GAAG,EAAER,CAAC,CAAC,CAAC;IAChCC,CAAC,EAAEL,QAAQ,CAACK,CAAC,IAAI;EACrB,CAAC;AACL,CAAC;;AAED;AACA;AACA;AACA,OAAO,MAAMQ,mBAAmB,GAAGA,CAACb,QAAQ,EAAEC,QAAQ,EAAEa,cAAc,EAAEC,eAAe,KAAK;EACxF,MAAMT,WAAW,GAAGQ,cAAc,IAAI9B,aAAa,CAACiB,QAAQ,CAAC,IAAIjB,aAAa,CAACC,OAAO;EACtF,MAAMsB,YAAY,GAAGQ,eAAe,IAAI3B,cAAc,CAACa,QAAQ,CAAC,IAAIb,cAAc,CAACH,OAAO;EAE1F,OAAO;IACHkB,CAAC,EAAEX,cAAc,CAACQ,QAAQ,CAACG,CAAC,IAAI,CAAC,EAAEG,WAAW,CAAC;IAC/CF,CAAC,EAAEZ,cAAc,CAACQ,QAAQ,CAACI,CAAC,IAAI,CAAC,EAAEG,YAAY,CAAC;IAChDF,CAAC,EAAEL,QAAQ,CAACK,CAAC,IAAI;EACrB,CAAC;AACL,CAAC;;AAED;AACA;AACA;AACA,OAAO,MAAMW,wBAAwB,GAAGA,CAACC,OAAO,EAAEC,QAAQ,EAAEC,MAAM,KAAK;EAAA,IAAAC,iBAAA;EACnE;EACA,MAAMC,YAAY,GAAG,EAAAD,iBAAA,GAAAH,OAAO,CAACjB,QAAQ,cAAAoB,iBAAA,uBAAhBA,iBAAA,CAAmBF,QAAQ,CAAC,KAAI;IAAEf,CAAC,EAAE,CAAC;IAAEC,CAAC,EAAE,CAAC;IAAEC,CAAC,EAAE;EAAE,CAAC;;EAEzE;EACA,IAAIY,OAAO,CAACK,IAAI,KAAK,SAAS,EAAE;IAC5B,OAAO;MAAEnB,CAAC,EAAE,CAAC;MAAEC,CAAC,EAAEiB,YAAY,CAACjB,CAAC;MAAEC,CAAC,EAAEgB,YAAY,CAAChB,CAAC,IAAI;IAAE,CAAC;EAC9D;EAEA,IAAIY,OAAO,CAACK,IAAI,KAAK,OAAO,IAAIL,OAAO,CAACK,IAAI,KAAK,OAAO,EAAE;IACtD;IACA,OAAO;MACHnB,CAAC,EAAEkB,YAAY,CAAClB,CAAC,IAAI,EAAE;MAAE;MACzBC,CAAC,EAAEiB,YAAY,CAACjB,CAAC,IAAI,EAAE;MACvBC,CAAC,EAAEgB,YAAY,CAAChB,CAAC,IAAI;IACzB,CAAC;EACL;;EAEA;EACA;EACA,OAAO;IACHF,CAAC,EAAEkB,YAAY,CAAClB,CAAC,IAAI,CAAC;IACtBC,CAAC,EAAEiB,YAAY,CAACjB,CAAC,IAAI,CAAC;IACtBC,CAAC,EAAEgB,YAAY,CAAChB,CAAC,IAAI;EACzB,CAAC;AACL,CAAC;;AAED;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO,MAAMkB,aAAa,GAAGA,CAACC,IAAI,EAAEC,WAAW,EAAExB,QAAQ,KAAK;EAC1D,IAAI,CAACuB,IAAI,EAAE;IACP,OAAOE,cAAc,CAACD,WAAW,EAAExB,QAAQ,CAAC;EAChD;EAEA,MAAMK,WAAW,GAAGtB,aAAa,CAACiB,QAAQ,CAAC,IAAIjB,aAAa,CAACC,OAAO;;EAEpE;EACA,IAAIwC,WAAW,KAAK,SAAS,EAAE;IAC3B,OAAO;MACHE,KAAK,EAAE,GAAG;MAAE;MACZC,MAAM,EAAEJ,IAAI,CAACI,MAAM,IAAI,GAAG;MAC1BhC,IAAI,EAAE;IACV,CAAC;EACL;;EAEA;EACA,IAAI6B,WAAW,KAAK,OAAO,IAAIA,WAAW,KAAK,OAAO,EAAE;IACpD,MAAMI,MAAM,GAAG;MAAE1C,MAAM,EAAE,GAAG;MAAED,MAAM,EAAE,GAAG;MAAED,OAAO,EAAE;IAAI,CAAC;IACzD,OAAO;MACH0C,KAAK,EAAEtC,cAAc,CAACwC,MAAM,CAAC5B,QAAQ,CAAC,IAAI,GAAG,EAAEK,WAAW,CAAC;MAC3DsB,MAAM,EAAEJ,IAAI,CAACI,MAAM,IAAI,GAAG;MAC1BhC,IAAI,EAAE,OAAO,CAAC;IAClB,CAAC;EACL;;EAEA;EACA,MAAMkC,WAAW,GAAGpC,aAAa,CAAC8B,IAAI,CAACG,KAAK,CAAC;EAC7C,MAAMA,KAAK,GAAG,CAAAG,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAElC,IAAI,MAAK,IAAI,GAClCP,cAAc,CAACyC,WAAW,CAACnC,KAAK,EAAEW,WAAW,CAAC,GAC7C,CAAAwB,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAEnC,KAAK,KAAI,EAAG;EAEhC,OAAO;IACHgC,KAAK,EAAEjB,IAAI,CAACC,GAAG,CAAC,CAAC,EAAED,IAAI,CAACE,GAAG,CAAC,GAAG,EAAEe,KAAK,CAAC,CAAC;IACxCC,MAAM,EAAEJ,IAAI,CAACI,MAAM,IAAI,EAAE;IACzBhC,IAAI,EAAE;EACV,CAAC;AACL,CAAC;;AAED;AACA;AACA;AACA,OAAO,MAAMmC,eAAe,GAAGA,CAACP,IAAI,EAAEvB,QAAQ,EAAEa,cAAc,KAAK;EAC/D,MAAMR,WAAW,GAAGQ,cAAc,IAAI9B,aAAa,CAACiB,QAAQ,CAAC,IAAIjB,aAAa,CAACC,OAAO;EAEtF,IAAI,CAACuC,IAAI,EAAE,OAAO;IAAEG,KAAK,EAAE,GAAG;IAAEC,MAAM,EAAE;EAAG,CAAC;EAE5C,MAAMD,KAAK,GAAGH,IAAI,CAAC5B,IAAI,KAAK,SAAS,IAAI4B,IAAI,CAAC5B,IAAI,KAAK,OAAO,GACxDJ,cAAc,CAACgC,IAAI,CAACG,KAAK,EAAErB,WAAW,CAAC,GACvCkB,IAAI,CAACG,KAAK;EAEhB,OAAO;IACHA,KAAK,EAAEjB,IAAI,CAACsB,KAAK,CAACL,KAAK,CAAC;IACxBC,MAAM,EAAEJ,IAAI,CAACI,MAAM,IAAI;EAC3B,CAAC;AACL,CAAC;;AAED;AACA;AACA;AACA,MAAMF,cAAc,GAAGA,CAACD,WAAW,EAAExB,QAAQ,KAAK;EAC9C,MAAMK,WAAW,GAAGtB,aAAa,CAACiB,QAAQ,CAAC,IAAIjB,aAAa,CAACC,OAAO;EAEpE,MAAMgD,QAAQ,GAAG;IACbC,OAAO,EAAE;MAAEP,KAAK,EAAE,GAAG;MAAEC,MAAM,EAAE,GAAG;MAAEhC,IAAI,EAAE;IAAU,CAAC;IACrDuC,KAAK,EAAE;MAAER,KAAK,EAAEtC,cAAc,CAAC,GAAG,EAAEiB,WAAW,CAAC;MAAEsB,MAAM,EAAE,GAAG;MAAEhC,IAAI,EAAE;IAAQ,CAAC;IAC9EwC,KAAK,EAAE;MAAET,KAAK,EAAEtC,cAAc,CAAC,GAAG,EAAEiB,WAAW,CAAC;MAAEsB,MAAM,EAAE,GAAG;MAAEhC,IAAI,EAAE;IAAQ,CAAC;IAC9EyC,MAAM,EAAE;MAAEV,KAAK,EAAEtC,cAAc,CAAC,GAAG,EAAEiB,WAAW,CAAC;MAAEsB,MAAM,EAAE,EAAE;MAAEhC,IAAI,EAAE;IAAQ,CAAC;IAC9E0C,IAAI,EAAE;MAAEX,KAAK,EAAEtC,cAAc,CAAC,EAAE,EAAEiB,WAAW,CAAC;MAAEsB,MAAM,EAAE,EAAE;MAAEhC,IAAI,EAAE;IAAQ,CAAC;IAC3E2C,KAAK,EAAE;MAAEZ,KAAK,EAAEtC,cAAc,CAAC,GAAG,EAAEiB,WAAW,CAAC;MAAEsB,MAAM,EAAE,GAAG;MAAEhC,IAAI,EAAE;IAAQ,CAAC;IAC9E4C,OAAO,EAAE;MAAEb,KAAK,EAAEtC,cAAc,CAAC,GAAG,EAAEiB,WAAW,CAAC;MAAEsB,MAAM,EAAE,EAAE;MAAEhC,IAAI,EAAE;IAAQ,CAAC;IAC/E6C,SAAS,EAAE;MAAEd,KAAK,EAAEtC,cAAc,CAAC,GAAG,EAAEiB,WAAW,CAAC;MAAEsB,MAAM,EAAE,GAAG;MAAEhC,IAAI,EAAE;IAAQ,CAAC;IAClF8C,OAAO,EAAE;MAAEf,KAAK,EAAEtC,cAAc,CAAC,GAAG,EAAEiB,WAAW,CAAC;MAAEsB,MAAM,EAAE,GAAG;MAAEhC,IAAI,EAAE;IAAQ,CAAC;IAChF+C,OAAO,EAAE;MAAEhB,KAAK,EAAEtC,cAAc,CAAC,GAAG,EAAEiB,WAAW,CAAC;MAAEsB,MAAM,EAAE,EAAE;MAAEhC,IAAI,EAAE;IAAQ;EAClF,CAAC;EAED,OAAOqC,QAAQ,CAACR,WAAW,CAAC,IAAIQ,QAAQ,CAACU,OAAO;AACpD,CAAC;;AAED;AACA;AACA;AACA,OAAO,MAAMC,cAAc,GAAGA,CAAC3B,OAAO,EAAEC,QAAQ,EAAEC,MAAM,KAAK;EAAA,IAAA0B,qBAAA;EACzD,MAAMC,QAAQ,GAAG,EAAAD,qBAAA,GAAA5B,OAAO,CAAC8B,cAAc,cAAAF,qBAAA,uBAAtBA,qBAAA,CAAyB3B,QAAQ,CAAC,KAC5CK,aAAa,CAACN,OAAO,CAACO,IAAI,EAAEP,OAAO,CAACK,IAAI,EAAEJ,QAAQ,CAAC;;EAE1D;EACA,IAAID,OAAO,CAACK,IAAI,KAAK,SAAS,EAAE;IAC5B,OAAO;MAAEK,KAAK,EAAE,GAAG;MAAEC,MAAM,EAAEkB,QAAQ,CAAClB,MAAM;MAAEhC,IAAI,EAAE;IAAU,CAAC;EACnE;;EAEA;EACA,IAAIqB,OAAO,CAACK,IAAI,KAAK,OAAO,IAAIL,OAAO,CAACK,IAAI,KAAK,OAAO,EAAE;IACtD,MAAMhB,WAAW,GAAGtB,aAAa,CAACmC,MAAM,CAAC;IACzC,MAAMU,MAAM,GAAG;MAAE1C,MAAM,EAAE,GAAG;MAAED,MAAM,EAAE,GAAG;MAAED,OAAO,EAAE;IAAI,CAAC;IACzD,OAAO;MACH0C,KAAK,EAAEtC,cAAc,CAACwC,MAAM,CAACV,MAAM,CAAC,IAAI,GAAG,EAAEb,WAAW,CAAC;MACzDsB,MAAM,EAAEkB,QAAQ,CAAClB,MAAM;MACvBhC,IAAI,EAAE;IACV,CAAC;EACL;;EAEA;EACA,MAAMoD,WAAW,GAAGhE,aAAa,CAACmC,MAAM,CAAC,GAAGnC,aAAa,CAACkC,QAAQ,CAAC;EACnE,IAAI+B,WAAW,GAAGH,QAAQ,CAACnB,KAAK,CAAC,CAAC;;EAElC;EACA,MAAMrB,WAAW,GAAGtB,aAAa,CAACmC,MAAM,CAAC;EACzC,MAAM+B,SAAS,GAAG;IACdb,MAAM,EAAE,EAAE;IAAEC,IAAI,EAAE,EAAE;IAAEC,KAAK,EAAE,GAAG;IAAEC,OAAO,EAAE,GAAG;IAC9CC,SAAS,EAAE,GAAG;IAAEC,OAAO,EAAE,GAAG;IAAEC,OAAO,EAAE;EAC3C,CAAC;EACD,MAAMQ,QAAQ,GAAGD,SAAS,CAACjC,OAAO,CAACK,IAAI,CAAC,IAAI4B,SAAS,CAACP,OAAO;EAC7D,MAAMS,eAAe,GAAG/D,cAAc,CAAC8D,QAAQ,EAAE7C,WAAW,CAAC;;EAE7D;EACA,IAAI+C,eAAe,GAAG,GAAG;EACzB,IAAIlC,MAAM,KAAK,QAAQ,EAAE;IACrBkC,eAAe,GAAGhE,cAAc,CAAC,GAAG,EAAEiB,WAAW,CAAC,CAAC,CAAC;EACxD;EAEA,OAAO;IACHqB,KAAK,EAAEjB,IAAI,CAACC,GAAG,CAACyC,eAAe,EAAE1C,IAAI,CAACE,GAAG,CAACqC,WAAW,EAAEI,eAAe,CAAC,CAAC;IACxEzB,MAAM,EAAElB,IAAI,CAACsB,KAAK,CAACc,QAAQ,CAAClB,MAAM,GAAGoB,WAAW,CAAC;IACjDpD,IAAI,EAAE;EACV,CAAC;AACL,CAAC;;AAED;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO,MAAM0D,WAAW,GAAGA,CAACC,MAAM,EAAErC,QAAQ,EAAEC,MAAM,KAAK;EACrD,IAAI,CAACoC,MAAM,EAAE,OAAO,CAAC,CAAC;EAEtB,MAAMP,WAAW,GAAGhE,aAAa,CAACmC,MAAM,CAAC,GAAGnC,aAAa,CAACkC,QAAQ,CAAC;EACnE,MAAMsC,YAAY,GAAG;IAAE,GAAGD;EAAO,CAAC;EAElC,MAAME,aAAa,GAAG,CAClB,UAAU,EAAE,SAAS,EAAE,YAAY,EAAE,eAAe,EACpD,aAAa,EAAE,cAAc,EAAE,QAAQ,EAAE,WAAW,EACpD,cAAc,EAAE,YAAY,EAAE,aAAa,EAAE,cAAc,EAC3D,KAAK,EAAE,aAAa,EAAE,aAAa,EAAE,YAAY,CACpD;EAEDA,aAAa,CAACC,OAAO,CAACC,IAAI,IAAI;IAC1B,IAAIH,YAAY,CAACG,IAAI,CAAC,EAAE;MACpB,MAAMC,MAAM,GAAGlE,aAAa,CAAC8D,YAAY,CAACG,IAAI,CAAC,CAAC;MAChD,IAAIC,MAAM,IAAIA,MAAM,CAAChE,IAAI,KAAK,IAAI,EAAE;QAChC,MAAMiE,MAAM,GAAGnD,IAAI,CAACsB,KAAK,CAAC4B,MAAM,CAACjE,KAAK,GAAGqD,WAAW,GAAG,EAAE,CAAC,GAAG,EAAE;QAC/D,MAAMpC,GAAG,GAAG+C,IAAI,CAACG,QAAQ,CAAC,MAAM,CAAC,GAAG,EAAE,GAAG,CAAC;QAC1CN,YAAY,CAACG,IAAI,CAAC,GAAG,GAAGjD,IAAI,CAACC,GAAG,CAACkD,MAAM,EAAEjD,GAAG,CAAC,IAAI;MACrD;IACJ;EACJ,CAAC,CAAC;;EAEF;EACA,IAAI4C,YAAY,CAACO,OAAO,IAAI,OAAOP,YAAY,CAACO,OAAO,KAAK,QAAQ,IAAIP,YAAY,CAACO,OAAO,CAACD,QAAQ,CAAC,GAAG,CAAC,EAAE;IACxG,MAAME,MAAM,GAAGR,YAAY,CAACO,OAAO,CAACE,KAAK,CAAC,GAAG,CAAC;IAC9C,MAAMC,YAAY,GAAGF,MAAM,CAACG,GAAG,CAACC,GAAG,IAAI;MACnC,MAAMR,MAAM,GAAGlE,aAAa,CAAC0E,GAAG,CAAC;MACjC,IAAIR,MAAM,IAAIA,MAAM,CAAChE,IAAI,KAAK,IAAI,EAAE;QAChC,MAAMiE,MAAM,GAAGnD,IAAI,CAACsB,KAAK,CAAC4B,MAAM,CAACjE,KAAK,GAAGqD,WAAW,GAAG,EAAE,CAAC,GAAG,EAAE;QAC/D,OAAO,GAAGtC,IAAI,CAACC,GAAG,CAACkD,MAAM,EAAE,CAAC,CAAC,IAAI;MACrC;MACA,OAAOO,GAAG;IACd,CAAC,CAAC;IACFZ,YAAY,CAACO,OAAO,GAAGG,YAAY,CAACG,IAAI,CAAC,GAAG,CAAC;EACjD;EAEA,OAAOb,YAAY;AACvB,CAAC;;AAED;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO,MAAMc,kBAAkB,GAAGA,CAACC,aAAa,EAAEpD,MAAM,KAAK;EACzD,IAAI,CAACoD,aAAa,EAAE,OAAO,CAAC,CAAC;EAE7B,MAAMV,MAAM,GAAG;IAAE,GAAGU;EAAc,CAAC;;EAEnC;EACA,IAAIV,MAAM,CAACW,OAAO,EAAE;IAChB,IAAIrD,MAAM,KAAK,QAAQ,IAAI0C,MAAM,CAACW,OAAO,GAAG,CAAC,EAAE;MAC3CX,MAAM,CAACW,OAAO,GAAG,CAAC;IACtB,CAAC,MAAM,IAAIrD,MAAM,KAAK,QAAQ,IAAI0C,MAAM,CAACW,OAAO,GAAG,CAAC,EAAE;MAClDX,MAAM,CAACW,OAAO,GAAG,CAAC;IACtB;EACJ;;EAEA;EACA,IAAIX,MAAM,CAACY,MAAM,IAAIZ,MAAM,CAACY,MAAM,CAACC,MAAM,GAAG,CAAC,EAAE;IAC3C,IAAIvD,MAAM,KAAK,QAAQ,EAAE;MACrB0C,MAAM,CAACc,mBAAmB,GAAG,gBAAgB;IACjD,CAAC,MAAM,IAAIxD,MAAM,KAAK,QAAQ,EAAE;MAC5B0C,MAAM,CAACc,mBAAmB,GAAG,gBAAgB;IACjD,CAAC,MAAM;MACHd,MAAM,CAACc,mBAAmB,GAAGd,MAAM,CAACc,mBAAmB,IAAI,gBAAgB;IAC/E;EACJ;;EAEA;EACA,IAAId,MAAM,CAACe,GAAG,EAAE;IACZ,MAAMhB,MAAM,GAAGlE,aAAa,CAACmE,MAAM,CAACe,GAAG,CAAC;IACxC,IAAIhB,MAAM,IAAIA,MAAM,CAAChE,IAAI,KAAK,IAAI,EAAE;MAChC,MAAMiF,MAAM,GAAG1D,MAAM,KAAK,QAAQ,GAAG,GAAG,GAAGA,MAAM,KAAK,QAAQ,GAAG,IAAI,GAAG,CAAC;MACzE0C,MAAM,CAACe,GAAG,GAAG,GAAGlE,IAAI,CAACC,GAAG,CAACiD,MAAM,CAACjE,KAAK,GAAGkF,MAAM,EAAE,CAAC,CAAC,IAAI;IAC1D;EACJ;EAEA,OAAOhB,MAAM;AACjB,CAAC;;AAED;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO,MAAMiB,uBAAuB,GAAGA,CAAC7D,OAAO,EAAE8D,WAAW,KAAK;EAC7D,MAAMC,KAAK,GAAG,CAAC,SAAS,EAAE,QAAQ,EAAE,QAAQ,CAAC;EAC7C,MAAMC,cAAc,GAAG;IAAE,GAAGhE;EAAQ,CAAC;;EAErC;EACA,IAAI,CAACgE,cAAc,CAACjF,QAAQ,EAAE;IAC1BiF,cAAc,CAACjF,QAAQ,GAAG,CAAC,CAAC;EAChC;;EAEA;EACA,IAAI,CAACiF,cAAc,CAAClC,cAAc,EAAE;IAChCkC,cAAc,CAAClC,cAAc,GAAG,CAAC,CAAC;EACtC;;EAEA;EACA,IAAI,CAACkC,cAAc,CAACjF,QAAQ,CAAC+E,WAAW,CAAC,EAAE;IACvCE,cAAc,CAACjF,QAAQ,CAAC+E,WAAW,CAAC,GAAGhF,iBAAiB,CACpDkF,cAAc,CAACjF,QAAQ,CAACf,OAAO,IAAI;MAAEkB,CAAC,EAAE,CAAC;MAAEC,CAAC,EAAE,CAAC;MAAEC,CAAC,EAAE;IAAE,CAAC,EACvD0E,WAAW,EACX,IAAI,CAAC;IACT,CAAC;EACL;EAEA,IAAI,CAACE,cAAc,CAAClC,cAAc,CAACgC,WAAW,CAAC,EAAE;IAC7CE,cAAc,CAAClC,cAAc,CAACgC,WAAW,CAAC,GAAGxD,aAAa,CACtD0D,cAAc,CAACzD,IAAI,EACnByD,cAAc,CAAC3D,IAAI,EACnByD,WACJ,CAAC;EACL;;EAEA;EACAC,KAAK,CAACtB,OAAO,CAACwB,UAAU,IAAI;IACxB,IAAIA,UAAU,KAAKH,WAAW,EAAE;MAC5B;MACAE,cAAc,CAACjF,QAAQ,CAACkF,UAAU,CAAC,GAAGlE,wBAAwB,CAC1DiE,cAAc,EACdF,WAAW,EACXG,UACJ,CAAC;;MAED;MACAD,cAAc,CAAClC,cAAc,CAACmC,UAAU,CAAC,GAAGtC,cAAc,CACtDqC,cAAc,EACdF,WAAW,EACXG,UACJ,CAAC;IACL;EACJ,CAAC,CAAC;;EAEF;EACA,IAAI,CAACD,cAAc,CAACE,gBAAgB,EAAE;IAClCF,cAAc,CAACE,gBAAgB,GAAG,CAAC,CAAC;EACxC;EAEAF,cAAc,CAACE,gBAAgB,CAACjG,MAAM,GAAGoE,WAAW,CAChD2B,cAAc,CAAC1B,MAAM,EACrB,SAAS,EACT,QACJ,CAAC;EAED0B,cAAc,CAACE,gBAAgB,CAAChG,MAAM,GAAGmE,WAAW,CAChD2B,cAAc,CAAC1B,MAAM,EACrB,SAAS,EACT,QACJ,CAAC;;EAED;EACA0B,cAAc,CAACG,mBAAmB,GAAGd,kBAAkB,CACnDW,cAAc,CAACV,aAAa,EAC5B,QACJ,CAAC;EAEDU,cAAc,CAACI,mBAAmB,GAAGf,kBAAkB,CACnDW,cAAc,CAACV,aAAa,EAC5B,QACJ,CAAC;;EAED;EACA,IAAIU,cAAc,CAACK,QAAQ,IAAIL,cAAc,CAACK,QAAQ,CAACZ,MAAM,GAAG,CAAC,EAAE;IAC/DO,cAAc,CAACK,QAAQ,GAAGL,cAAc,CAACK,QAAQ,CAACnB,GAAG,CAACoB,KAAK,IACvDT,uBAAuB,CAACS,KAAK,EAAER,WAAW,CAC9C,CAAC;EACL;EAEA,OAAOE,cAAc;AACzB,CAAC;;AAED;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO,MAAMO,gBAAgB,GAAGA,CAACvE,OAAO,EAAEhB,QAAQ,EAAEwF,gBAAgB,KAAK;EAAA,IAAAC,kBAAA,EAAAC,sBAAA,EAAAC,qBAAA;EACrE,IAAI9E,cAAc,GAAG9B,aAAa,CAACiB,QAAQ,CAAC;EAC5C,IAAIc,eAAe,GAAG3B,cAAc,CAACa,QAAQ,CAAC;;EAE9C;EACA,IAAIwF,gBAAgB,EAAE;IAClB,MAAMI,IAAI,GAAGJ,gBAAgB,CAACK,qBAAqB,CAAC,CAAC;IACrDhF,cAAc,GAAG+E,IAAI,CAAClE,KAAK;IAC3BZ,eAAe,GAAG8E,IAAI,CAACjE,MAAM;EACjC;;EAEA;EACA,MAAMmE,kBAAkB,GAAG,EAAAL,kBAAA,GAAAzE,OAAO,CAACjB,QAAQ,cAAA0F,kBAAA,uBAAhBA,kBAAA,CAAmBzF,QAAQ,CAAC,KAAI;IAAEE,CAAC,EAAE,CAAC;IAAEC,CAAC,EAAE,CAAC;IAAEC,CAAC,EAAE;EAAE,CAAC;EAC/E,MAAM0C,cAAc,GAAG,EAAA4C,sBAAA,GAAA1E,OAAO,CAAC8B,cAAc,cAAA4C,sBAAA,uBAAtBA,sBAAA,CAAyB1F,QAAQ,CAAC,KAClDsB,aAAa,CAACN,OAAO,CAACO,IAAI,EAAEP,OAAO,CAACK,IAAI,EAAErB,QAAQ,CAAC;;EAE1D;EACA,MAAMD,QAAQ,GAAGa,mBAAmB,CAACkF,kBAAkB,EAAE9F,QAAQ,EAAEa,cAAc,EAAEC,eAAe,CAAC;EACnG,MAAMS,IAAI,GAAGO,eAAe,CAACgB,cAAc,EAAE9C,QAAQ,EAAEa,cAAc,CAAC;;EAEtE;EACA,MAAMkF,UAAU,GAAG/E,OAAO,CAACsC,MAAM,IAAI,CAAC,CAAC;EACvC,MAAM4B,gBAAgB,GAAG,EAAAS,qBAAA,GAAA3E,OAAO,CAACkE,gBAAgB,cAAAS,qBAAA,uBAAxBA,qBAAA,CAA2B3F,QAAQ,CAAC,KAAI,CAAC,CAAC;EACnE,MAAMsD,MAAM,GAAG;IAAE,GAAGyC,UAAU;IAAE,GAAGb;EAAiB,CAAC;;EAErD;EACA,MAAMc,iBAAiB,GAAGhF,OAAO,CAACsD,aAAa,IAAI,CAAC,CAAC;EACrD,MAAM2B,uBAAuB,GACzBjG,QAAQ,KAAK,QAAQ,GAAGgB,OAAO,CAACoE,mBAAmB,GAC/CpF,QAAQ,KAAK,QAAQ,GAAGgB,OAAO,CAACmE,mBAAmB,GAC/C,CAAC,CAAC;EACd,MAAMb,aAAa,GAAG;IAAE,GAAG0B,iBAAiB;IAAE,GAAGC;EAAwB,CAAC;EAE1E,OAAO;IACHC,EAAE,EAAElF,OAAO,CAACkF,EAAE;IACd7E,IAAI,EAAEL,OAAO,CAACK,IAAI;IAClBtB,QAAQ;IACRwB,IAAI;IACJ+B,MAAM;IACNgB,aAAa;IACbe,QAAQ,EAAErE,OAAO,CAACqE,QAAQ,IAAI,EAAE;IAChCc,OAAO,EAAEnF,OAAO,CAACmF,OAAO,KAAK;EACjC,CAAC;AACL,CAAC;;AAED;AACA;AACA;AACA,OAAO,MAAMC,eAAe,GAAGA,CAACC,QAAQ,EAAEC,WAAW,KAAK;EACtD,OAAO;IACH,GAAGD,QAAQ;IACXE,QAAQ,EAAEF,QAAQ,CAACE,QAAQ,CAACrC,GAAG,CAAClD,OAAO,IACnC6D,uBAAuB,CAAC7D,OAAO,EAAEsF,WAAW,CAChD;EACJ,CAAC;AACL,CAAC;;AAED;AACA;AACA;AACA,OAAO,MAAME,wBAAwB,GAAGA,CAACxF,OAAO,EAAEyF,QAAQ,GAAG,SAAS,KAAK;EACvE,OAAO5B,uBAAuB,CAAC7D,OAAO,EAAEyF,QAAQ,CAAC;AACrD,CAAC;;AAED;AACA;AACA;AACA,OAAO,MAAMC,4BAA4B,GAAIL,QAAQ,IAAK;EACtD,OAAO;IACH,GAAGA,QAAQ;IACXE,QAAQ,EAAEF,QAAQ,CAACE,QAAQ,CAACrC,GAAG,CAAClD,OAAO,IAAI;MAAA,IAAA2F,kBAAA;MACvC;MACA,IAAI,GAAAA,kBAAA,GAAC3F,OAAO,CAACjB,QAAQ,cAAA4G,kBAAA,eAAhBA,kBAAA,CAAkBzH,MAAM,KAAI,CAAC8B,OAAO,CAAC8B,cAAc,EAAE;QACtD,OAAO0D,wBAAwB,CAACxF,OAAO,EAAE,SAAS,CAAC;MACvD;MACA,OAAOA,OAAO;IAClB,CAAC;EACL,CAAC;AACL,CAAC;;AAED;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO,MAAM4F,4BAA4B,GAAI5F,OAAO,IAAK;EACrD,MAAM+D,KAAK,GAAG,CAAC,SAAS,EAAE,QAAQ,EAAE,QAAQ,CAAC;EAC7C,MAAM8B,QAAQ,GAAG;IAAE,GAAG7F;EAAQ,CAAC;;EAE/B;EACA,IAAI,CAAC6F,QAAQ,CAAC9G,QAAQ,EAAE;IACpB8G,QAAQ,CAAC9G,QAAQ,GAAG,CAAC,CAAC;EAC1B;EAEAgF,KAAK,CAACtB,OAAO,CAACqD,IAAI,IAAI;IAClB,IAAID,QAAQ,CAAC9G,QAAQ,CAAC+G,IAAI,CAAC,EAAE;MACzBD,QAAQ,CAAC9G,QAAQ,CAAC+G,IAAI,CAAC,GAAGhH,iBAAiB,CACvC+G,QAAQ,CAAC9G,QAAQ,CAAC+G,IAAI,CAAC,EACvBA,IAAI,EACJ,IAAI,CAAC;MACT,CAAC;IACL;EACJ,CAAC,CAAC;;EAEF;EACA,IAAI,CAACD,QAAQ,CAAC/D,cAAc,EAAE;IAC1B+D,QAAQ,CAAC/D,cAAc,GAAG,CAAC,CAAC;EAChC;EAEAiC,KAAK,CAACtB,OAAO,CAACqD,IAAI,IAAI;IAClB,MAAMC,OAAO,GAAGD,IAAI,KAAK,QAAQ,GAAG,YAAY,GAC5CA,IAAI,KAAK,QAAQ,GAAG,YAAY,GAAG,MAAM;IAE7C,IAAID,QAAQ,CAACE,OAAO,CAAC,EAAE;MACnBF,QAAQ,CAAC/D,cAAc,CAACgE,IAAI,CAAC,GAAGxF,aAAa,CACzCuF,QAAQ,CAACE,OAAO,CAAC,EACjBF,QAAQ,CAACxF,IAAI,EACbyF,IACJ,CAAC;IACL;EACJ,CAAC,CAAC;;EAEF;EACA,IAAID,QAAQ,CAACxB,QAAQ,IAAIwB,QAAQ,CAACxB,QAAQ,CAACZ,MAAM,GAAG,CAAC,EAAE;IACnDoC,QAAQ,CAACxB,QAAQ,GAAGwB,QAAQ,CAACxB,QAAQ,CAACnB,GAAG,CAAC0C,4BAA4B,CAAC;EAC3E;EAEA,OAAOC,QAAQ;AACnB,CAAC;;AAED;AACA;AACA;AACA,OAAO,MAAMG,6BAA6B,GAAIX,QAAQ,IAAK;EACvD,OAAO;IACH,GAAGA,QAAQ;IACXE,QAAQ,EAAEF,QAAQ,CAACE,QAAQ,CAACrC,GAAG,CAAC0C,4BAA4B;EAChE,CAAC;AACL,CAAC;;AAED;AACA;AACA;;AAEA,eAAe;EACX;EACA9G,iBAAiB;EACjBc,mBAAmB;EACnBG,wBAAwB;EAExB;EACAO,aAAa;EACbQ,eAAe;EACfa,cAAc;EAEd;EACAU,WAAW;EACXgB,kBAAkB;EAElB;EACAQ,uBAAuB;EACvBuB,eAAe;EAEf;EACAb,gBAAgB;EAEhB;EACAiB,wBAAwB;EACxBE,4BAA4B;EAE5B;EACAE,4BAA4B;EAC5BI,6BAA6B;EAE7B;EACA5H,cAAc;EACdG,cAAc;EAEd;EACAR,aAAa;EACbI;AACJ,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}