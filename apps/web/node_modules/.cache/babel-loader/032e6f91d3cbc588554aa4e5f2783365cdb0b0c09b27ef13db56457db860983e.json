{"ast":null,"code":"/**\r\n * RESPONSIVE UTILS - FIXED VERSION ✅\r\n */\n\n/**\r\n * Tính scale factor giữa các view modes\r\n */\nexport const getScaleFactor = (fromMode, toMode) => {\n  const widths = {\n    desktop: 1200,\n    tablet: 768,\n    mobile: 375\n  };\n  return widths[toMode] / widths[fromMode];\n};\n\n/**\r\n * Tự động scale size cho element\r\n */\nexport const autoScaleSize = (element, fromMode, toMode) => {\n  var _element$size3, _element$size3$fromMo, _element$size4, _element$size4$fromMo;\n  const scaleFactor = getScaleFactor(fromMode, toMode);\n\n  // Section luôn full-width, scale height\n  if (element.type === 'section') {\n    var _element$size, _element$size$fromMod;\n    return {\n      width: toMode === 'mobile' ? 375 : toMode === 'tablet' ? 768 : 1200,\n      height: Math.round((((_element$size = element.size) === null || _element$size === void 0 ? void 0 : (_element$size$fromMod = _element$size[fromMode]) === null || _element$size$fromMod === void 0 ? void 0 : _element$size$fromMod.height) || 400) * scaleFactor)\n    };\n  }\n\n  // Popup center với width fixed, scale height\n  if (element.type === 'popup' || element.type === 'modal') {\n    var _element$size2, _element$size2$fromMo;\n    return {\n      width: toMode === 'mobile' ? 340 : toMode === 'tablet' ? 600 : 600,\n      height: Math.round((((_element$size2 = element.size) === null || _element$size2 === void 0 ? void 0 : (_element$size2$fromMo = _element$size2[fromMode]) === null || _element$size2$fromMo === void 0 ? void 0 : _element$size2$fromMo.height) || 400) * scaleFactor)\n    };\n  }\n\n  // Scale các element khác - LẤY TỪ MODE SOURCE\n  const baseWidth = ((_element$size3 = element.size) === null || _element$size3 === void 0 ? void 0 : (_element$size3$fromMo = _element$size3[fromMode]) === null || _element$size3$fromMo === void 0 ? void 0 : _element$size3$fromMo.width) || 200;\n  const baseHeight = ((_element$size4 = element.size) === null || _element$size4 === void 0 ? void 0 : (_element$size4$fromMo = _element$size4[fromMode]) === null || _element$size4$fromMo === void 0 ? void 0 : _element$size4$fromMo.height) || 50;\n  let scaledWidth = Math.round(baseWidth * scaleFactor);\n  let scaledHeight = Math.round(baseHeight * scaleFactor);\n\n  // Minimum sizes theo type\n  const minSizes = {\n    button: {\n      width: 80,\n      height: 32\n    },\n    icon: {\n      width: 24,\n      height: 24\n    },\n    image: {\n      width: 100,\n      height: 100\n    },\n    heading: {\n      width: 150,\n      height: 24\n    },\n    paragraph: {\n      width: 200,\n      height: 40\n    },\n    gallery: {\n      width: 300,\n      height: 200\n    },\n    default: {\n      width: 100,\n      height: 40\n    }\n  };\n  const minSize = minSizes[element.type] || minSizes.default;\n\n  // Maximum width cho mobile\n  if (toMode === 'mobile') {\n    scaledWidth = Math.min(scaledWidth, 340);\n  }\n  return {\n    width: Math.max(scaledWidth, minSize.width),\n    height: Math.max(scaledHeight, minSize.height)\n  };\n};\n\n/**\r\n * Tự động scale position cho element\r\n */\nexport const autoScalePosition = (element, fromMode, toMode, newSize) => {\n  var _element$position;\n  const fromPos = ((_element$position = element.position) === null || _element$position === void 0 ? void 0 : _element$position[fromMode]) || {\n    x: 0,\n    y: 0,\n    z: 1\n  };\n  const scaleFactor = getScaleFactor(fromMode, toMode);\n\n  // Section luôn x = 0, y scale\n  if (element.type === 'section') {\n    return {\n      x: 0,\n      y: Math.round(fromPos.y * scaleFactor),\n      z: fromPos.z || 1\n    };\n  }\n\n  // Popup center\n  if (element.type === 'popup' || element.type === 'modal') {\n    const canvasW = toMode === 'mobile' ? 375 : toMode === 'tablet' ? 768 : 1200;\n    return {\n      x: Math.round((canvasW - (newSize.width || 600)) / 2),\n      y: Math.round(fromPos.y * scaleFactor),\n      z: fromPos.z || 1001\n    };\n  }\n\n  // Scale position\n  let scaledX = Math.round(fromPos.x * scaleFactor);\n  let scaledY = Math.round(fromPos.y * scaleFactor);\n\n  // Đảm bảo không overflow\n  const canvasWidth = toMode === 'mobile' ? 375 : toMode === 'tablet' ? 768 : 1200;\n  const elementWidth = (newSize === null || newSize === void 0 ? void 0 : newSize.width) || 200;\n  if (scaledX + elementWidth > canvasWidth) {\n    scaledX = Math.max(0, canvasWidth - elementWidth - 10);\n  }\n  return {\n    x: Math.max(0, scaledX),\n    y: Math.max(0, scaledY),\n    z: fromPos.z || 1\n  };\n};\n\n/**\r\n * Scale styles (font, padding, margin, etc.)\r\n */\nexport const autoScaleStyles = (styles, fromMode, toMode) => {\n  if (!styles) return {};\n  const scaleFactor = getScaleFactor(fromMode, toMode);\n  const scaledStyles = {\n    ...styles\n  };\n\n  // Properties cần scale\n  const scalableProps = ['fontSize', 'padding', 'paddingTop', 'paddingBottom', 'paddingLeft', 'paddingRight', 'margin', 'marginTop', 'marginBottom', 'marginLeft', 'marginRight', 'borderRadius', 'gap', 'borderWidth', 'strokeWidth', 'lineHeight'];\n  scalableProps.forEach(prop => {\n    if (scaledStyles[prop]) {\n      const value = scaledStyles[prop];\n      // Parse number + unit\n      if (typeof value === 'string') {\n        const match = value.match(/^([\\d.]+)(px|rem|em|%)$/);\n        if (match) {\n          const num = parseFloat(match[1]);\n          const unit = match[2];\n\n          // Scale pixel values\n          if (unit === 'px') {\n            const scaled = Math.round(num * scaleFactor * 10) / 10;\n            // Minimum values\n            const min = prop.includes('font') ? 10 : 4;\n            scaledStyles[prop] = `${Math.max(scaled, min)}${unit}`;\n          }\n        }\n      } else if (typeof value === 'number') {\n        const scaled = Math.round(value * scaleFactor);\n        const min = prop.includes('font') ? 10 : 4;\n        scaledStyles[prop] = Math.max(scaled, min);\n      }\n    }\n  });\n\n  // Scale compound values (padding: \"10px 20px\")\n  if (scaledStyles.padding && typeof scaledStyles.padding === 'string' && scaledStyles.padding.includes(' ')) {\n    const values = scaledStyles.padding.split(' ');\n    const scaledValues = values.map(val => {\n      const match = val.match(/^([\\d.]+)(px|rem|em)$/);\n      if (match) {\n        const num = parseFloat(match[1]);\n        const unit = match[2];\n        const scaled = Math.round(num * scaleFactor * 10) / 10;\n        return `${Math.max(scaled, 4)}${unit}`;\n      }\n      return val;\n    });\n    scaledStyles.padding = scaledValues.join(' ');\n  }\n  return scaledStyles;\n};\n\n/**\r\n * Scale componentData (columns, images grid, etc.)\r\n */\nexport const autoScaleComponentData = (componentData, toMode) => {\n  if (!componentData) return {};\n  const scaled = {\n    ...componentData\n  };\n  if (toMode === 'mobile') {\n    // Giảm columns cho mobile\n    if (scaled.columns && scaled.columns > 2) {\n      scaled.columns = 1;\n    }\n\n    // Grid template columns cho gallery\n    if (scaled.images && scaled.images.length > 0) {\n      scaled.gridTemplateColumns = 'repeat(2, 1fr)'; // Mobile: 2 columns\n    }\n\n    // Scale gap\n    if (scaled.gap) {\n      const match = scaled.gap.match(/^([\\d.]+)(px|rem)$/);\n      if (match) {\n        const value = parseFloat(match[1]);\n        const unit = match[2];\n        scaled.gap = `${Math.max(value * 0.5, 8)}${unit}`;\n      }\n    }\n  } else if (toMode === 'tablet') {\n    // Giảm columns cho tablet\n    if (scaled.columns && scaled.columns > 3) {\n      scaled.columns = 2;\n    }\n    if (scaled.images && scaled.images.length > 0) {\n      scaled.gridTemplateColumns = 'repeat(3, 1fr)'; // Tablet: 3 columns\n    }\n  }\n  return scaled;\n};\n\n/**\r\n * MAIN FUNCTION: Sync element giữa các view modes\r\n */\nexport const syncElementBetweenModes = (element, changedMode) => {\n  const modes = ['desktop', 'tablet', 'mobile'];\n  const updatedElement = {\n    ...element\n  };\n\n  // Đảm bảo có position/size cho tất cả modes\n  updatedElement.position = updatedElement.position || {};\n  updatedElement.size = updatedElement.size || {};\n\n  // Sync từ changedMode sang các modes khác\n  modes.forEach(targetMode => {\n    if (targetMode !== changedMode) {\n      // Scale size và lưu theo mode\n      const scaledSize = autoScaleSize(updatedElement, changedMode, targetMode);\n      updatedElement.size[targetMode] = scaledSize;\n\n      // Scale position\n      const scaledPosition = autoScalePosition(updatedElement, changedMode, targetMode, scaledSize);\n      updatedElement.position[targetMode] = scaledPosition;\n    }\n  });\n\n  // Scale styles cho mobile/tablet - lưu riêng\n  updatedElement.responsiveStyles = updatedElement.responsiveStyles || {};\n  updatedElement.responsiveStyles.mobile = autoScaleStyles(updatedElement.styles || {}, 'desktop', 'mobile');\n  updatedElement.responsiveStyles.tablet = autoScaleStyles(updatedElement.styles || {}, 'desktop', 'tablet');\n\n  // Scale componentData - lưu riêng\n  updatedElement.mobileComponentData = autoScaleComponentData(updatedElement.componentData || {}, 'mobile');\n  updatedElement.tabletComponentData = autoScaleComponentData(updatedElement.componentData || {}, 'tablet');\n\n  // Sync children nếu có - TRÁNH LOOP: chỉ 1 level\n  if (updatedElement.children && updatedElement.children.length > 0) {\n    updatedElement.children = updatedElement.children.map(child => {\n      const updatedChild = {\n        ...child\n      };\n      updatedChild.position = {\n        ...updatedElement.position\n      };\n      updatedChild.size = {\n        ...updatedElement.size\n      };\n      return updatedChild;\n    });\n  }\n  return updatedElement;\n};\n\n/**\r\n * Sync toàn bộ pageData khi chuyển view mode\r\n */\nexport const syncAllElements = (pageData, currentMode) => {\n  return {\n    ...pageData,\n    elements: pageData.elements.map(element => syncElementBetweenModes(element, currentMode))\n  };\n};\n\n/**\r\n * Get responsive values dựa trên viewMode hiện tại\r\n */\nexport const getResponsiveValues = (element, viewMode) => {\n  var _element$size5, _element$position2, _element$responsiveSt;\n  const size = ((_element$size5 = element.size) === null || _element$size5 === void 0 ? void 0 : _element$size5[viewMode]) || {\n    width: element.type === 'section' ? viewMode === 'mobile' ? 375 : viewMode === 'tablet' ? 768 : 1200 : 200,\n    height: 400\n  };\n  const position = ((_element$position2 = element.position) === null || _element$position2 === void 0 ? void 0 : _element$position2[viewMode]) || {\n    x: 0,\n    y: 0,\n    z: 1\n  };\n\n  // FIXED: Base styles trước, responsive override sau\n  const styles = viewMode === 'desktop' ? element.styles || {} : {\n    ...(element.styles || {}),\n    ...(((_element$responsiveSt = element.responsiveStyles) === null || _element$responsiveSt === void 0 ? void 0 : _element$responsiveSt[viewMode]) || {})\n  };\n\n  // FIXED: Base componentData trước, responsive override sau\n  const componentData = viewMode === 'desktop' ? element.componentData || {} : {\n    ...(element.componentData || {}),\n    ...(element[viewMode + 'ComponentData'] || {})\n  };\n\n  // Đồng bộ hóa thuộc tính background từ styles sang componentData nếu cần\n  if (!componentData.backgroundType) {\n    if (styles.backgroundImage) {\n      componentData.backgroundType = 'image';\n      componentData.backgroundImage = styles.backgroundImage.replace(/^url\\([\"']?(.+?)[\"']?\\)$/, '$1');\n      componentData.backgroundSize = styles.backgroundSize || 'cover';\n      componentData.backgroundPosition = styles.backgroundPosition || 'center';\n      componentData.backgroundRepeat = styles.backgroundRepeat || 'no-repeat';\n      componentData.backgroundAttachment = styles.backgroundAttachment || 'scroll';\n    } else if (styles.background && styles.background.includes('gradient')) {\n      componentData.backgroundType = 'gradient';\n      componentData.gradient = styles.background;\n    } else if (styles.backgroundColor && styles.backgroundColor !== 'transparent') {\n      componentData.backgroundType = 'color';\n      componentData.backgroundColor = styles.backgroundColor;\n    } else {\n      componentData.backgroundType = 'color';\n      componentData.backgroundColor = componentData.backgroundColor || styles.backgroundColor || '#ffffff';\n    }\n  }\n\n  // REMOVED: console.log để tránh spam\n\n  return {\n    id: element.id,\n    type: element.type,\n    size,\n    position,\n    styles,\n    componentData,\n    children: element.children || [],\n    visible: element.visible !== false\n  };\n};\n\n/**\r\n * Initialize responsive data cho elements chưa có\r\n */\nexport const initializeResponsiveData = pageData => {\n  return {\n    ...pageData,\n    elements: pageData.elements.map(element => {\n      var _element$position3, _element$position4;\n      // Nếu chưa có responsive data, tạo mới\n      if (!((_element$position3 = element.position) !== null && _element$position3 !== void 0 && _element$position3.mobile) || !((_element$position4 = element.position) !== null && _element$position4 !== void 0 && _element$position4.tablet)) {\n        return syncElementBetweenModes(element, 'desktop');\n      }\n      return element;\n    })\n  };\n};\n\n/**\r\n * Batch update khi user thay đổi nhiều elements\r\n */\nexport const batchSyncElements = (elements, changedMode) => {\n  return elements.map(element => syncElementBetweenModes(element, changedMode));\n};\nexport default {\n  getScaleFactor,\n  autoScaleSize,\n  autoScalePosition,\n  autoScaleStyles,\n  autoScaleComponentData,\n  syncElementBetweenModes,\n  syncAllElements,\n  getResponsiveValues,\n  initializeResponsiveData,\n  batchSyncElements\n};","map":{"version":3,"names":["getScaleFactor","fromMode","toMode","widths","desktop","tablet","mobile","autoScaleSize","element","_element$size3","_element$size3$fromMo","_element$size4","_element$size4$fromMo","scaleFactor","type","_element$size","_element$size$fromMod","width","height","Math","round","size","_element$size2","_element$size2$fromMo","baseWidth","baseHeight","scaledWidth","scaledHeight","minSizes","button","icon","image","heading","paragraph","gallery","default","minSize","min","max","autoScalePosition","newSize","_element$position","fromPos","position","x","y","z","canvasW","scaledX","scaledY","canvasWidth","elementWidth","autoScaleStyles","styles","scaledStyles","scalableProps","forEach","prop","value","match","num","parseFloat","unit","scaled","includes","padding","values","split","scaledValues","map","val","join","autoScaleComponentData","componentData","columns","images","length","gridTemplateColumns","gap","syncElementBetweenModes","changedMode","modes","updatedElement","targetMode","scaledSize","scaledPosition","responsiveStyles","mobileComponentData","tabletComponentData","children","child","updatedChild","syncAllElements","pageData","currentMode","elements","getResponsiveValues","viewMode","_element$size5","_element$position2","_element$responsiveSt","backgroundType","backgroundImage","replace","backgroundSize","backgroundPosition","backgroundRepeat","backgroundAttachment","background","gradient","backgroundColor","id","visible","initializeResponsiveData","_element$position3","_element$position4","batchSyncElements"],"sources":["F:/landinghub-iconic/apps/web/src/utils/responsiveSync.js"],"sourcesContent":["/**\r\n * RESPONSIVE UTILS - FIXED VERSION ✅\r\n */\r\n\r\n/**\r\n * Tính scale factor giữa các view modes\r\n */\r\nexport const getScaleFactor = (fromMode, toMode) => {\r\n    const widths = { desktop: 1200, tablet: 768, mobile: 375 };\r\n    return widths[toMode] / widths[fromMode];\r\n};\r\n\r\n/**\r\n * Tự động scale size cho element\r\n */\r\nexport const autoScaleSize = (element, fromMode, toMode) => {\r\n    const scaleFactor = getScaleFactor(fromMode, toMode);\r\n\r\n    // Section luôn full-width, scale height\r\n    if (element.type === 'section') {\r\n        return {\r\n            width: toMode === 'mobile' ? 375 : toMode === 'tablet' ? 768 : 1200,\r\n            height: Math.round((element.size?.[fromMode]?.height || 400) * scaleFactor)\r\n        };\r\n    }\r\n\r\n    // Popup center với width fixed, scale height\r\n    if (element.type === 'popup' || element.type === 'modal') {\r\n        return {\r\n            width: toMode === 'mobile' ? 340 : toMode === 'tablet' ? 600 : 600,\r\n            height: Math.round((element.size?.[fromMode]?.height || 400) * scaleFactor)\r\n        };\r\n    }\r\n\r\n    // Scale các element khác - LẤY TỪ MODE SOURCE\r\n    const baseWidth = element.size?.[fromMode]?.width || 200;\r\n    const baseHeight = element.size?.[fromMode]?.height || 50;\r\n\r\n    let scaledWidth = Math.round(baseWidth * scaleFactor);\r\n    let scaledHeight = Math.round(baseHeight * scaleFactor);\r\n\r\n    // Minimum sizes theo type\r\n    const minSizes = {\r\n        button: { width: 80, height: 32 },\r\n        icon: { width: 24, height: 24 },\r\n        image: { width: 100, height: 100 },\r\n        heading: { width: 150, height: 24 },\r\n        paragraph: { width: 200, height: 40 },\r\n        gallery: { width: 300, height: 200 },\r\n        default: { width: 100, height: 40 }\r\n    };\r\n\r\n    const minSize = minSizes[element.type] || minSizes.default;\r\n\r\n    // Maximum width cho mobile\r\n    if (toMode === 'mobile') {\r\n        scaledWidth = Math.min(scaledWidth, 340);\r\n    }\r\n\r\n    return {\r\n        width: Math.max(scaledWidth, minSize.width),\r\n        height: Math.max(scaledHeight, minSize.height)\r\n    };\r\n};\r\n\r\n/**\r\n * Tự động scale position cho element\r\n */\r\nexport const autoScalePosition = (element, fromMode, toMode, newSize) => {\r\n    const fromPos = element.position?.[fromMode] || { x: 0, y: 0, z: 1 };\r\n    const scaleFactor = getScaleFactor(fromMode, toMode);\r\n\r\n    // Section luôn x = 0, y scale\r\n    if (element.type === 'section') {\r\n        return { x: 0, y: Math.round(fromPos.y * scaleFactor), z: fromPos.z || 1 };\r\n    }\r\n\r\n    // Popup center\r\n    if (element.type === 'popup' || element.type === 'modal') {\r\n        const canvasW = toMode === 'mobile' ? 375 : toMode === 'tablet' ? 768 : 1200;\r\n        return {\r\n            x: Math.round((canvasW - (newSize.width || 600)) / 2),\r\n            y: Math.round(fromPos.y * scaleFactor),\r\n            z: fromPos.z || 1001\r\n        };\r\n    }\r\n\r\n    // Scale position\r\n    let scaledX = Math.round(fromPos.x * scaleFactor);\r\n    let scaledY = Math.round(fromPos.y * scaleFactor);\r\n\r\n    // Đảm bảo không overflow\r\n    const canvasWidth = toMode === 'mobile' ? 375 : toMode === 'tablet' ? 768 : 1200;\r\n    const elementWidth = newSize?.width || 200;\r\n\r\n    if (scaledX + elementWidth > canvasWidth) {\r\n        scaledX = Math.max(0, canvasWidth - elementWidth - 10);\r\n    }\r\n\r\n    return {\r\n        x: Math.max(0, scaledX),\r\n        y: Math.max(0, scaledY),\r\n        z: fromPos.z || 1\r\n    };\r\n};\r\n\r\n/**\r\n * Scale styles (font, padding, margin, etc.)\r\n */\r\nexport const autoScaleStyles = (styles, fromMode, toMode) => {\r\n    if (!styles) return {};\r\n\r\n    const scaleFactor = getScaleFactor(fromMode, toMode);\r\n    const scaledStyles = { ...styles };\r\n\r\n    // Properties cần scale\r\n    const scalableProps = [\r\n        'fontSize', 'padding', 'paddingTop', 'paddingBottom', 'paddingLeft', 'paddingRight',\r\n        'margin', 'marginTop', 'marginBottom', 'marginLeft', 'marginRight',\r\n        'borderRadius', 'gap', 'borderWidth', 'strokeWidth', 'lineHeight'\r\n    ];\r\n\r\n    scalableProps.forEach(prop => {\r\n        if (scaledStyles[prop]) {\r\n            const value = scaledStyles[prop];\r\n            // Parse number + unit\r\n            if (typeof value === 'string') {\r\n                const match = value.match(/^([\\d.]+)(px|rem|em|%)$/);\r\n                if (match) {\r\n                    const num = parseFloat(match[1]);\r\n                    const unit = match[2];\r\n\r\n                    // Scale pixel values\r\n                    if (unit === 'px') {\r\n                        const scaled = Math.round(num * scaleFactor * 10) / 10;\r\n                        // Minimum values\r\n                        const min = prop.includes('font') ? 10 : 4;\r\n                        scaledStyles[prop] = `${Math.max(scaled, min)}${unit}`;\r\n                    }\r\n                }\r\n            } else if (typeof value === 'number') {\r\n                const scaled = Math.round(value * scaleFactor);\r\n                const min = prop.includes('font') ? 10 : 4;\r\n                scaledStyles[prop] = Math.max(scaled, min);\r\n            }\r\n        }\r\n    });\r\n\r\n    // Scale compound values (padding: \"10px 20px\")\r\n    if (scaledStyles.padding && typeof scaledStyles.padding === 'string' && scaledStyles.padding.includes(' ')) {\r\n        const values = scaledStyles.padding.split(' ');\r\n        const scaledValues = values.map(val => {\r\n            const match = val.match(/^([\\d.]+)(px|rem|em)$/);\r\n            if (match) {\r\n                const num = parseFloat(match[1]);\r\n                const unit = match[2];\r\n                const scaled = Math.round(num * scaleFactor * 10) / 10;\r\n                return `${Math.max(scaled, 4)}${unit}`;\r\n            }\r\n            return val;\r\n        });\r\n        scaledStyles.padding = scaledValues.join(' ');\r\n    }\r\n\r\n    return scaledStyles;\r\n};\r\n\r\n/**\r\n * Scale componentData (columns, images grid, etc.)\r\n */\r\nexport const autoScaleComponentData = (componentData, toMode) => {\r\n    if (!componentData) return {};\r\n\r\n    const scaled = { ...componentData };\r\n\r\n    if (toMode === 'mobile') {\r\n        // Giảm columns cho mobile\r\n        if (scaled.columns && scaled.columns > 2) {\r\n            scaled.columns = 1;\r\n        }\r\n\r\n        // Grid template columns cho gallery\r\n        if (scaled.images && scaled.images.length > 0) {\r\n            scaled.gridTemplateColumns = 'repeat(2, 1fr)'; // Mobile: 2 columns\r\n        }\r\n\r\n        // Scale gap\r\n        if (scaled.gap) {\r\n            const match = scaled.gap.match(/^([\\d.]+)(px|rem)$/);\r\n            if (match) {\r\n                const value = parseFloat(match[1]);\r\n                const unit = match[2];\r\n                scaled.gap = `${Math.max(value * 0.5, 8)}${unit}`;\r\n            }\r\n        }\r\n    } else if (toMode === 'tablet') {\r\n        // Giảm columns cho tablet\r\n        if (scaled.columns && scaled.columns > 3) {\r\n            scaled.columns = 2;\r\n        }\r\n\r\n        if (scaled.images && scaled.images.length > 0) {\r\n            scaled.gridTemplateColumns = 'repeat(3, 1fr)'; // Tablet: 3 columns\r\n        }\r\n    }\r\n\r\n    return scaled;\r\n};\r\n\r\n/**\r\n * MAIN FUNCTION: Sync element giữa các view modes\r\n */\r\nexport const syncElementBetweenModes = (element, changedMode) => {\r\n    const modes = ['desktop', 'tablet', 'mobile'];\r\n    const updatedElement = { ...element };\r\n\r\n    // Đảm bảo có position/size cho tất cả modes\r\n    updatedElement.position = updatedElement.position || {};\r\n    updatedElement.size = updatedElement.size || {};\r\n\r\n    // Sync từ changedMode sang các modes khác\r\n    modes.forEach(targetMode => {\r\n        if (targetMode !== changedMode) {\r\n            // Scale size và lưu theo mode\r\n            const scaledSize = autoScaleSize(updatedElement, changedMode, targetMode);\r\n            updatedElement.size[targetMode] = scaledSize;\r\n\r\n            // Scale position\r\n            const scaledPosition = autoScalePosition(updatedElement, changedMode, targetMode, scaledSize);\r\n            updatedElement.position[targetMode] = scaledPosition;\r\n        }\r\n    });\r\n\r\n    // Scale styles cho mobile/tablet - lưu riêng\r\n    updatedElement.responsiveStyles = updatedElement.responsiveStyles || {};\r\n    updatedElement.responsiveStyles.mobile = autoScaleStyles(\r\n        updatedElement.styles || {},\r\n        'desktop',\r\n        'mobile'\r\n    );\r\n    updatedElement.responsiveStyles.tablet = autoScaleStyles(\r\n        updatedElement.styles || {},\r\n        'desktop',\r\n        'tablet'\r\n    );\r\n\r\n    // Scale componentData - lưu riêng\r\n    updatedElement.mobileComponentData = autoScaleComponentData(\r\n        updatedElement.componentData || {},\r\n        'mobile'\r\n    );\r\n    updatedElement.tabletComponentData = autoScaleComponentData(\r\n        updatedElement.componentData || {},\r\n        'tablet'\r\n    );\r\n\r\n    // Sync children nếu có - TRÁNH LOOP: chỉ 1 level\r\n    if (updatedElement.children && updatedElement.children.length > 0) {\r\n        updatedElement.children = updatedElement.children.map(child => {\r\n            const updatedChild = { ...child };\r\n            updatedChild.position = { ...updatedElement.position };\r\n            updatedChild.size = { ...updatedElement.size };\r\n            return updatedChild;\r\n        });\r\n    }\r\n\r\n    return updatedElement;\r\n};\r\n\r\n/**\r\n * Sync toàn bộ pageData khi chuyển view mode\r\n */\r\nexport const syncAllElements = (pageData, currentMode) => {\r\n    return {\r\n        ...pageData,\r\n        elements: pageData.elements.map(element =>\r\n            syncElementBetweenModes(element, currentMode)\r\n        )\r\n    };\r\n};\r\n\r\n/**\r\n * Get responsive values dựa trên viewMode hiện tại\r\n */\r\nexport const getResponsiveValues = (element, viewMode) => {\r\n    const size = element.size?.[viewMode] || {\r\n        width: element.type === 'section' ? (viewMode === 'mobile' ? 375 : viewMode === 'tablet' ? 768 : 1200) : 200,\r\n        height: 400,\r\n    };\r\n\r\n    const position = element.position?.[viewMode] || { x: 0, y: 0, z: 1 };\r\n\r\n    // FIXED: Base styles trước, responsive override sau\r\n    const styles = viewMode === 'desktop'\r\n        ? (element.styles || {})\r\n        : { ...(element.styles || {}), ...(element.responsiveStyles?.[viewMode] || {}) };\r\n\r\n    // FIXED: Base componentData trước, responsive override sau\r\n    const componentData = viewMode === 'desktop'\r\n        ? (element.componentData || {})\r\n        : { ...(element.componentData || {}), ...(element[viewMode + 'ComponentData'] || {}) };\r\n\r\n    // Đồng bộ hóa thuộc tính background từ styles sang componentData nếu cần\r\n    if (!componentData.backgroundType) {\r\n        if (styles.backgroundImage) {\r\n            componentData.backgroundType = 'image';\r\n            componentData.backgroundImage = styles.backgroundImage.replace(/^url\\([\"']?(.+?)[\"']?\\)$/, '$1');\r\n            componentData.backgroundSize = styles.backgroundSize || 'cover';\r\n            componentData.backgroundPosition = styles.backgroundPosition || 'center';\r\n            componentData.backgroundRepeat = styles.backgroundRepeat || 'no-repeat';\r\n            componentData.backgroundAttachment = styles.backgroundAttachment || 'scroll';\r\n        } else if (styles.background && styles.background.includes('gradient')) {\r\n            componentData.backgroundType = 'gradient';\r\n            componentData.gradient = styles.background;\r\n        } else if (styles.backgroundColor && styles.backgroundColor !== 'transparent') {\r\n            componentData.backgroundType = 'color';\r\n            componentData.backgroundColor = styles.backgroundColor;\r\n        } else {\r\n            componentData.backgroundType = 'color';\r\n            componentData.backgroundColor = componentData.backgroundColor || styles.backgroundColor || '#ffffff';\r\n        }\r\n    }\r\n\r\n    // REMOVED: console.log để tránh spam\r\n\r\n    return {\r\n        id: element.id,\r\n        type: element.type,\r\n        size,\r\n        position,\r\n        styles,\r\n        componentData,\r\n        children: element.children || [],\r\n        visible: element.visible !== false,\r\n    };\r\n};\r\n\r\n/**\r\n * Initialize responsive data cho elements chưa có\r\n */\r\nexport const initializeResponsiveData = (pageData) => {\r\n    return {\r\n        ...pageData,\r\n        elements: pageData.elements.map(element => {\r\n            // Nếu chưa có responsive data, tạo mới\r\n            if (!element.position?.mobile || !element.position?.tablet) {\r\n                return syncElementBetweenModes(element, 'desktop');\r\n            }\r\n            return element;\r\n        })\r\n    };\r\n};\r\n\r\n/**\r\n * Batch update khi user thay đổi nhiều elements\r\n */\r\nexport const batchSyncElements = (elements, changedMode) => {\r\n    return elements.map(element => syncElementBetweenModes(element, changedMode));\r\n};\r\n\r\nexport default {\r\n    getScaleFactor,\r\n    autoScaleSize,\r\n    autoScalePosition,\r\n    autoScaleStyles,\r\n    autoScaleComponentData,\r\n    syncElementBetweenModes,\r\n    syncAllElements,\r\n    getResponsiveValues,\r\n    initializeResponsiveData,\r\n    batchSyncElements\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}